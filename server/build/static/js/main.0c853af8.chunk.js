(this.webpackJsonpstayvirtual_chat_application=this.webpackJsonpstayvirtual_chat_application||[]).push([[0],{112:function(e,t,n){},114:function(e,t,n){},138:function(e,t,n){},181:function(e,t){},186:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),o=n(52),c=n.n(o),s=n(11),i=n(17),l=(n(112),n(7));var u=function(e){var t=e.users;return Object(l.jsx)("div",{className:"container",style:{position:"fixed",top:"200px",zIndex:"99999",pointerEvents:"auto",maxWidth:"250px",display:"flex",flexDirection:"column"},children:t?Object(l.jsxs)("div",{children:[Object(l.jsx)("p",{style:{whiteSpace:"pre-wrap"},children:"THE HRWAILL ARCHIVE of Human Expressions is a user generated data set that unfolds into a 3D landscape. \nPlay as data input for the semi-sentient machine learning algorithm HRWAILL and enjoy First Person Shooter access to its slowly expanding index of signs, images and symbols. \nClick on landscape to toggle controls AWSD \nClick ESC to reclaim control of your cursor"}),Object(l.jsx)("p",{className:"users-headline",children:"Online users"}),Object(l.jsx)("div",{className:"users",children:t.map((function(e){return Object(l.jsxs)("div",{className:"activeItem",children:[Object(l.jsx)("p",{children:e.name}),Object(l.jsx)("img",{alt:"Online Icon",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAGCAYAAADgzO9IAAAAAXNSR0IArs4c6QAAAExJREFUCB1jbPh/le3lx5tNDIwMcQwg8J9hkTi/eh0LWJCBoRwoAAPlQDEGJrhKmDCIBupmQuYjs5lAZiILgNlAMRaQRSAz4UZCLQcAIwYaiAejKoYAAAAASUVORK5CYII="})]},e.name)}))})]}):null})},f=n(67),j=n.n(f),m=function(e){var t,n=e.message,a=n.text,r=n.user,o=e.name,c=!1;return o&&(t=o.trim()),r===t&&(c=!0),c?Object(l.jsxs)("div",{className:"messageContainer justifyEnd",children:[Object(l.jsx)("p",{className:"sentText pr-10",children:t}),Object(l.jsx)("p",{className:"messageText",children:j.a.emojify(a)})]}):Object(l.jsxs)("div",{className:"messageContainer justifyEnd",children:[Object(l.jsx)("p",{className:"sentText pl-10 ",children:r}),Object(l.jsx)("p",{className:"messageText",children:j.a.emojify(a)})]})};var d=function(e){var t=e.messages,n=e.name,r=Object(a.useRef)(null);return Object(a.useEffect)((function(){r.current.scrollIntoView({behavior:"smooth"})}),[t]),Object(l.jsxs)("div",{className:"messages",style:{pointerEvents:"auto"},children:[t.map((function(e,t){return Object(l.jsx)("div",{children:Object(l.jsx)(m,{message:e,name:n})},t)})),Object(l.jsx)("div",{ref:r})]})},p=(n(114),function(e){var t=e.setMessage,n=e.sendMessage,a=e.message;return Object(l.jsxs)("form",{className:"form",children:[Object(l.jsx)("input",{className:"input",type:"text",placeholder:"Type a message...",value:a,onChange:function(e){var n=e.target.value;return t(n)},onKeyPress:function(e){return"Enter"===e.key?n(e):null}}),Object(l.jsx)("button",{className:"sendButton",onClick:function(e){return n(e)},children:"Send"})]})}),b=function(e){var t=e.socket,n=Object(a.useState)(),r=Object(s.a)(n,2),o=r[0],c=r[1],f=Object(a.useState)(""),j=Object(s.a)(f,2),m=j[0],b=j[1],h=Object(a.useState)(""),O=Object(s.a)(h,2),x=O[0],v=O[1],g=Object(a.useState)([]),w=Object(s.a)(g,2),y=w[0],M=w[1];Object(a.useEffect)((function(){e.loggedIn&&(t.on("message",(function(e){M((function(t){return[].concat(Object(i.a)(t),[e])}))})),t.on("roomData",(function(e){var t=e.users,n=e.username;b(t),c(n)})))}),[e.loggedIn,t]);return Object(l.jsx)("div",{style:{position:"absolute",top:"0",bottom:"0",right:"0",left:"0",zIndex:"0",pointerEvents:"none"},children:e.loggedIn&&Object(l.jsxs)(l.Fragment,{children:[Object(l.jsxs)("div",{className:"chatContainer containerframe",style:{pointerEvents:"auto"},children:[Object(l.jsx)(d,{messages:y,name:o}),Object(l.jsx)(p,{message:x,setMessage:v,sendMessage:function(e){e.preventDefault(),x&&t.emit("sendMessage",x,(function(){return v("")}))}})]}),Object(l.jsx)(u,{users:m})]})})},h=n(20),O=n.n(h),x=n(29),v=n(1),g=n(6),w=n(4),y=n(5),M=n(10),S=n(13),k=n(59),P=n(102);Object(S.b)({PointerLockControlsImpl:P.a});var A=function(e){var t=Object(S.e)(),n=t.camera,r=t.gl,o=Object(a.useRef)();return Object(a.useEffect)((function(){document.getElementById("canvas").addEventListener("click",(function(){o.current&&o.current.lock()}))}),[]),Object(l.jsx)(l.Fragment,{children:Object(l.jsx)("pointerLockControlsImpl",Object(M.a)({ref:o,args:[n,r.domElement]},e))})},I=n(15);function R(e){return{KeyW:"moveForward",KeyS:"moveBackward",KeyD:"moveRight",KeyA:"moveLeft",ArrowUp:"moveForward",ArrowDown:"moveBackward",ArrowRight:"moveRight",ArrowLeft:"moveLeft",Space:"jump"}[e]}var D=n(0),E=n(191),_=function(e){var t=Object(S.e)().camera,n=function(){var e=Object(a.useState)({moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1,jump:!1}),t=Object(s.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){var e=function(e){R(e.code)&&r((function(t){return Object(M.a)(Object(M.a)({},t),{},Object(I.a)({},R(e.code),!0))}))},t=function(e){R(e.code)&&r((function(t){return Object(M.a)(Object(M.a)({},t),{},Object(I.a)({},R(e.code),!1))}))};return document.addEventListener("keydown",e),document.addEventListener("keyup",t),function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",t)}}),[]),n}(),r=n.moveForward,o=n.moveBackward,c=n.moveLeft,i=n.moveRight,u=n.jump,f=Object(k.b)((function(){return Object(M.a)({mass:1,type:"Dynamic"},e)})),j=Object(s.a)(f,2),m=j[0],d=j[1],p=Object(a.useRef)([0,0,0]);return Object(a.useEffect)((function(){d.velocity.subscribe((function(e){return p.current=e}))}),[d.velocity]),Object(S.c)((function(){t.position.copy(m.current.position);var e=new D.Vector3,n=new D.Vector3(0,0,(o?1:0)-(r?1:0)),a=new D.Vector3((c?1:0)-(i?1:0),0,0);e.subVectors(n,a).normalize().multiplyScalar(6).applyEuler(t.rotation),u&&Math.abs(p.current[1].toFixed(2))<.05&&(d.velocity.set(p.current[0],2,p.current[2]),u=!1),d.velocity.set(e.x,p.current[1],e.z)})),Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(A,{starter:e.starter}),Object(l.jsx)("mesh",{ref:m})]})},N=function(e){var t=Object(a.useState)(!1),n=Object(s.a)(t,2),r=n[0],o=n[1],c=Object(S.e)().camera;return Object(a.useEffect)((function(){document.getElementById("canvas").addEventListener("click",(function(){r||o(!0)}))}),[r]),Object(l.jsx)(l.Fragment,{children:r?Object(l.jsx)(_,{position:[c.position.x,1,c.position.y]}):Object(l.jsx)(l.Fragment,{children:Object(l.jsx)(E.a,{autoRotate:!0,autoRotateSpeed:-1.8,maxZoom:30,minZoom:10,minDistance:10,maxDistance:50,maxPolarAngle:Math.PI/2-.1})})})},C=function(e){Object(w.a)(n,e);var t=Object(y.a)(n);function n(){return Object(v.a)(this,n),t.call(this,{uniforms:{uTime:{value:0},uPixelRatio:{value:Math.min(window.devicePixelRatio,2)},uSize:{value:150}},vertexShader:"\n      uniform float uPixelRatio;\n      uniform float uSize;\n      uniform float uTime;\n      attribute float aScale;    \n      void main() {\n        vec4 modelPosition = modelMatrix * vec4(position, 1.0);\n        modelPosition.y += sin(uTime + modelPosition.x * 100.0) * aScale * 0.2;\n        modelPosition.z += cos(uTime + modelPosition.x * 100.0) * aScale * 0.2;\n        modelPosition.x += cos(uTime + modelPosition.x * 100.0) * aScale * 0.2;\n        vec4 viewPosition = viewMatrix * modelPosition;\n        vec4 projectionPostion = projectionMatrix * viewPosition;    \n        gl_Position = projectionPostion;\n        gl_PointSize = uSize * aScale * uPixelRatio;\n        gl_PointSize *= (1.0 / - viewPosition.z);\n      }",fragmentShader:"\n      void main() {\n        float distanceToCenter = distance(gl_PointCoord, vec2(0.5));\n        float strength = 0.05 / distanceToCenter - 0.1;\n        gl_FragColor = vec4(1.0, 1.0, 1.0, strength);\n      }"})}return Object(g.a)(n,[{key:"time",get:function(){return this.uniforms.uTime.value},set:function(e){this.uniforms.uTime.value=e}}]),n}(D.ShaderMaterial);function T(e){var t=e.count,n=e.position,r=Object(a.useRef)(),o=Object(a.useMemo)((function(){for(var e=new Float32Array(3*t),n=new Float32Array(t),a=0;a<t;a++)new D.Vector3(100*(Math.random()-.5),1.5*Math.random(),100*(Math.random()-.5)).toArray(e,3*a),n[a]=Math.random();return[e,n]}),[t]),c=Object(s.a)(o,2),i=c[0],u=c[1];return Object(S.c)((function(e,t){return r.current.time+=t/2})),Object(l.jsx)("mesh",{position:n,children:Object(l.jsxs)("points",{children:[Object(l.jsxs)("bufferGeometry",{children:[Object(l.jsx)("bufferAttribute",{attachObject:["attributes","position"],count:t,array:i,itemSize:3}),Object(l.jsx)("bufferAttribute",{attachObject:["attributes","aScale"],count:t,array:u,itemSize:1})]}),Object(l.jsx)("fireflyMaterial",{ref:r,transparent:!0,depthWrite:!1})]},t)})}Object(S.b)({FireflyMaterial:C});var z=n(188),F=n(189),L=n(190),U=n(192),B=n(193),W=n(22),V=n(187),G=function(e){Object(w.a)(n,e);var t=Object(y.a)(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(v.a)(this,n),(e=t.call(this,a)).setValues(a),e._flowMapOffset0={value:null},e._flowMapOffset1={value:null},e._tDiffuse={value:null},e._tNormalMap0={value:null},e._tNormalMap1={value:null},e._textureMatrix={value:null},e._reflectorOpacity={value:.2},e}return Object(g.a)(n,[{key:"onBeforeCompile",value:function(e){e.uniforms.flowMapOffset0=this._flowMapOffset0,e.uniforms.flowMapOffset1=this._flowMapOffset1,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tNormalMap0=this._tNormalMap0,e.uniforms.tNormalMap1=this._tNormalMap1,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.reflectorOpacity=this._reflectorOpacity,e.vertexShader="\n        uniform mat4 textureMatrix;\n        varying vec4 my_vUv;\n     \n      ".concat(e.vertexShader,"\n    "),e.vertexShader=e.vertexShader.replace("#include <project_vertex>","\n        #include <project_vertex>\n        my_vUv = textureMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        "),e.fragmentShader="\n        uniform sampler2D tDiffuse;\n        uniform float flowMapOffset0;\n        uniform float flowMapOffset1;\n        uniform float reflectorOpacity;\n        uniform sampler2D tNormalMap0;\n        uniform sampler2D tNormalMap1;\n        varying vec4 my_vUv;\n        ".concat(e.fragmentShader,"\n    "),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>","\n        #include <map_fragment>\n\n        float halfCycle = 1.0/2.0;\n        float scale = 1.0;\n        vec3 toEye = normalize( vec3(1.0,1.0,0.0) );\n        \n        // determine flow direction\n        vec2 flow = vec2(0.8,0.3);\n        flow.x *= - 1.0;\n        \n        // sample normal maps (distort uvs with flowdata)\n        vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );\n        vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );\n        \n        // linear interpolate to get the final normal color\n        float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\n        vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n        \n        // calculate normal vector\n        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n        \n        // calculate the fresnel term to blend reflection and refraction maps\n        float theta = max( dot( toEye, my_normal ), 0.0 );\n        float reflectance = 1.0 + ( 1.0 - 1.0 ) * pow( ( 1.0 - theta ), 5.0 );\n        \n        // calculate final uv coords\n        vec3 coord = my_vUv.xyz / my_vUv.w;\n        vec2 uv = coord.xy + coord.z * my_normal.xz * 0.05;\n        \n        vec4 myTexelRoughness = texture2D( roughnessMap, vUv );\n        vec4 baseWater = texture2D( tDiffuse, uv);\n        vec4 base = texture2DProj( tDiffuse, my_vUv );\n        vec4 mixedBase = mix(base, baseWater, myTexelRoughness.r > 0.5 ? 0.0 : 1.0);\n        mixedBase *= 1.0 - myTexelRoughness.r;\n        diffuseColor.rgb += reflectorOpacity * mixedBase.rgb;\n      ")}},{key:"flowMapOffset0",get:function(){return this._flowMapOffset0.value},set:function(e){this._flowMapOffset0.value=e}},{key:"flowMapOffset1",get:function(){return this._flowMapOffset1.value},set:function(e){this._flowMapOffset1.value=e}},{key:"tDiffuse",get:function(){return this._tDiffuse.value},set:function(e){this._tDiffuse.value=e}},{key:"tNormalMap0",get:function(){return this._tNormalMap0.value},set:function(e){this._tNormalMap0.value=e}},{key:"tNormalMap1",get:function(){return this._tNormalMap1.value},set:function(e){this._tNormalMap1.value=e}},{key:"textureMatrix",get:function(){return this._textureMatrix.value},set:function(e){this._textureMatrix.value=e}},{key:"reflectorOpacity",get:function(){return this._reflectorOpacity.value},set:function(e){this._reflectorOpacity.value=e}}]),n}(D.MeshPhysicalMaterial),H=function(e){var t=e.savePass,n=e.textureMatrix;return r.a.forwardRef((function(e,r){var o=Object(a.useState)((function(){return new G})),c=Object(s.a)(o,1)[0],i=Object(V.a)(["/BASE.jpg","/AO.jpg","/HEIGHT.png","/NORMAL.jpg","/ROUGHNESS.jpg"]),u=Object(V.a)(["/Water_2.jpg","/Water_2.jpg"]);return Object(a.useEffect)((function(){i.forEach((function(e){e.wrapS=e.wrapT=D.RepeatWrapping,e.repeat.set(1,1)})),u.forEach((function(e){e.wrapS=e.wrapT=D.RepeatWrapping,e.repeat.set(1,1)}))}),[i,u]),Object(S.c)((function(e){var t=e.clock;if(c){var n=t.getDelta();c.flowMapOffset0+=10*n,c.flowMapOffset1=c.flowMapOffset0+.5,c.flowMapOffset0>=1?(c.flowMapOffset0=0,c.flowMapOffset1=.5):c.flowMapOffset1>=1&&(c.flowMapOffset1=c.flowMapOffset1-1)}})),Object(l.jsx)("primitive",Object(M.a)(Object(M.a)({object:c,ref:r,attach:"material"},e),{},{textureMatrix:n,tDiffuse:t.renderTarget.texture,side:D.DoubleSide,map:i[0],aoMap:i[1],myMap:i[2],displacementMap:i[2],displacementScale:.5,normalMap:i[3],normalScale:[.7,.7],roughnessMap:i[4],tNormalMap0:u[0],tNormalMap1:u[1]}))}))};var K=n(40);var J=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=Object(S.e)(),n=t.gl,r=t.size,o=t.scene,c=t.camera,l=Object(S.d)(W.m),u=Object(a.useMemo)((function(){var t=new W.f(n,{frameBufferType:D.HalfFloatType,multisampling:0}),a=new W.k(o,c),r=new W.c({offset:new D.Vector2(.001,.001)}),s=new W.b({luminanceSmoothing:.3,intensity:.5}),u=new W.i({blendFunction:W.a.COLOR_DODGE});u.blendMode.opacity.value=.03;var f=Object(K.a)(W.l,Object(i.a)(l));f.edgeDetectionMaterial.setEdgeDetectionThreshold(.05),f.edgeDetectionMaterial.setPredicationMode(W.j.DEPTH),f.edgeDetectionMaterial.setPredicationThreshold(.002),f.edgeDetectionMaterial.setPredicationScale(1);var j=new W.o({blendFunction:W.a.SKIP,texture:f.renderTargetEdges.texture}),m=new W.o({blendFunction:W.a.SKIP,texture:f.renderTargetWeights.texture}),d=new W.g(c,f,j,m,s,u),p=new W.g(c,r);return e.forEach((function(e){return t.addPass(e)})),t.addPass(a),t.addPass(d),t.addPass(p),[t]}),[n,o,c,e,l]),f=Object(s.a)(u,1),j=f[0];Object(a.useEffect)((function(){j.setSize(r.width,r.height)}),[j,r]),Object(S.c)((function(e,t){j.render(t)}),-1)},Q=n(103),Y=n.n(Q),Z="https://9080d9c066cb.eu-west-1.playback.live-video.net/api/video/v1/eu-west-1.554958627116.channel.DTf3HzFPw6Tl.m3u8";function X(e){var t=Object(a.useState)(!1),n=Object(s.a)(t,2),r=n[0],o=n[1],c=Object(a.useRef)();return Object(a.useEffect)((function(){!function(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1),t.send(),404!==t.status?o(!0):o(!1)}(Z),c.current&&e.callbackFunction()}),[c,e]),Object(l.jsx)("div",{className:"container",style:{position:"fixed",top:"0",left:"0",zIndex:"99999",pointerEvents:"auto",width:"250px",height:"180px",display:"flex",flexDirection:"column"},children:r?Object(l.jsx)(Y.a,{ref:c,url:Z,width:"100%",height:"105%",playing:!0,controls:!0,disablePictureInPicture:!0,id:"video"}):Object(l.jsx)("img",{style:{height:"100%",objectFit:"contain"},src:"https://res.cloudinary.com/www-houseofkilling-com/image/upload/w_1000,ar_1:1,c_fill,g_auto,e_art:hokusai/v1622725933/contentRedistribution/hrwail1_zgguct.png",alt:"HRWAILL_icon"})})}function q(e){var t=Object(a.useRef)(),n=Object(S.e)(),r=n.scene,o=n.gl,c=Object(a.useState)((function(){return new D.WebGLCubeRenderTarget(256)})),i=Object(s.a)(c,1)[0];return Object(S.c)((function(){return t.current.update(o,r)})),Object(l.jsxs)("mesh",{position:e.position,children:[Object(l.jsx)("cubeCamera",{ref:t,args:[1,1e3,i]}),Object(l.jsxs)("mesh",{children:[Object(l.jsx)("sphereBufferGeometry",{args:e.args}),Object(l.jsx)(F.a,{attach:"material",color:"black",envMap:i.texture,factor:2,speed:.6,roughness:0,metalness:10,distort:0,side:2})]})]})}function $(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function ee(e){var t=e.imageUrls,n=e.material,r=Object(a.useRef)();return t.map((function(e,t){return Object(l.jsxs)("mesh",{ref:r,position:[$(-50,50),Math.floor(10*Math.random()),$(-50,50)],castShadow:!0,receiveShadow:!0,children:[Object(l.jsx)("boxBufferGeometry",{attach:"geometry",args:[5,5,5],color:"white"}),Object(l.jsx)(a.Suspense,{fallback:null,children:Object(l.jsx)(te,{imageUrl:e,material:n})})]},t)}))}Object(z.a)();var te=function(e,t){var n=Object(S.d)(D.TextureLoader,e.imageUrl);return Object(l.jsx)("meshStandardMaterial",{attach:"material",roughness:1,color:"white",map:n,material:t})};function ne(){var e=Object(a.useRef)(),t=Object(a.useRef)();return Object(S.c)((function(n){var a=.5*n.clock.getElapsedTime();e.current&&t.current&&(e.current.position.x=50*Math.sin(a),t.current.position.x=50*Math.sin(a),e.current.position.z=50*Math.cos(a),t.current.position.z=50*Math.sin(a),t.current.position.y=50*Math.sin(a))})),Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("spotLight",{ref:e,position:[20,20,10],intensity:3,castShadow:!0,color:"#00e9ff",angle:Math.PI/3,penumbra:1,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024}),Object(l.jsx)("spotLight",{ref:t,position:[20,20,10],intensity:.2,castShadow:!0,color:"#e1ff00",angle:Math.PI/3,penumbra:1,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024})]})}function ae(){var e=Object(a.useState)((function(){var e=document.getElementById("video").getElementsByTagName("video")[0];return e.crossOrigin="Anonymous",e})),t=Object(s.a)(e,1)[0],n=Object(S.e)().camera,r=Object(a.useRef)();return Object(S.c)((function(e){e.clock;r.current&&(r.current.position.set(n.position.x,n.position.y,n.position.z),r.current.rotation.y+=.008)})),Object(l.jsxs)("group",{ref:r,position:[n.position.x,n.position.y,n.position.z],children:[Object(l.jsxs)("mesh",{position:[0,3,33],children:[Object(l.jsx)("boxBufferGeometry",{args:[10,9,.1],rotation:[Math.PI/2,Math.PI/2,Math.PI/2]}),Object(l.jsx)("meshBasicMaterial",{children:Object(l.jsx)("videoTexture",{attach:"map",args:[t]})})]}),Object(l.jsxs)("mesh",{position:[20,7,0],children:[Object(l.jsx)("boxBufferGeometry",{args:[.1,5,6],rotation:[Math.PI/2,0,0]}),Object(l.jsx)("meshBasicMaterial",{children:Object(l.jsx)("videoTexture",{attach:"map",args:[t]})})]}),Object(l.jsxs)("mesh",{position:[-10,15,-5],children:[Object(l.jsx)("boxBufferGeometry",{args:[7,.1,6],rotation:[Math.PI/2,0,0]}),Object(l.jsx)("meshBasicMaterial",{children:Object(l.jsx)("videoTexture",{attach:"map",args:[t]})})]})]})}function re(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:512,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Object(a.useRef)(),o=Object(a.useState)((function(){return new D.Plane})),c=Object(s.a)(o,1)[0],i=Object(a.useState)((function(){return new D.Vector3})),l=Object(s.a)(i,1)[0],u=Object(a.useState)((function(){return new D.Vector3})),f=Object(s.a)(u,1)[0],j=Object(a.useState)((function(){return new D.Vector3})),m=Object(s.a)(j,1)[0],d=Object(a.useState)((function(){return new D.Matrix4})),p=Object(s.a)(d,1)[0],b=Object(a.useState)((function(){return new D.Vector3(0,0,-1)})),h=Object(s.a)(b,1)[0],O=Object(a.useState)((function(){return new D.Vector4})),x=Object(s.a)(O,1)[0],v=Object(a.useState)((function(){return new D.Vector3})),g=Object(s.a)(v,1)[0],w=Object(a.useState)((function(){return new D.Vector3})),y=Object(s.a)(w,1)[0],M=Object(a.useState)((function(){return new D.Vector4})),k=Object(s.a)(M,1)[0],P=Object(a.useState)((function(){return new D.Matrix4})),A=Object(s.a)(P,1)[0],I=Object(a.useState)((function(){return new D.PerspectiveCamera})),R=Object(s.a)(I,1)[0],E=Object(S.e)(),_=E.gl,N=E.scene,C=E.camera,T=Object(a.useCallback)((function(){if(r.current&&(r.current.visible=!1,f.setFromMatrixPosition(r.current.matrixWorld),m.setFromMatrixPosition(C.matrixWorld),p.extractRotation(r.current.matrixWorld),l.set(0,0,1),l.applyMatrix4(p),g.subVectors(f,m),!(g.dot(l)>0))){g.reflect(l).negate(),g.add(f),p.extractRotation(C.matrixWorld),h.set(0,0,-1),h.applyMatrix4(p),h.add(m),y.subVectors(f,h),y.reflect(l).negate(),y.add(f),R.position.copy(g),R.up.set(0,1,0),R.up.applyMatrix4(p),R.up.reflect(l),R.lookAt(y),R.far=C.far,R.updateMatrixWorld(),R.projectionMatrix.copy(C.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(R.projectionMatrix),A.multiply(R.matrixWorldInverse),A.multiply(r.current.matrixWorld),c.setFromNormalAndCoplanarPoint(l,f),c.applyMatrix4(R.matrixWorldInverse),x.set(c.normal.x,c.normal.y,c.normal.z,c.constant);var e=R.projectionMatrix;k.x=(Math.sign(x.x)+e.elements[8])/e.elements[0],k.y=(Math.sign(x.y)+e.elements[9])/e.elements[5],k.z=-1,k.w=(1+e.elements[10])/e.elements[14],x.multiplyScalar(2/x.dot(k)),e.elements[2]=x.x,e.elements[6]=x.y,e.elements[10]=x.z+1-n,e.elements[14]=x.w}}),[n,r,C,c,l,f,m,p,h,x,g,y,k,A,R]);function z(){r.current&&(r.current.visible=!0)}var F=Object(a.useMemo)((function(){var n={minFilter:D.LinearFilter,magFilter:D.LinearFilter,format:D.RGBFormat},a=new D.WebGLRenderTarget(e,t,n);a.texture.encoding=_.outputEncoding,D.MathUtils.isPowerOfTwo(e)&&D.MathUtils.isPowerOfTwo(t)||(a.texture.generateMipmaps=!1);var r=new W.k(N,R),o=new W.e(N,R),c=new W.d(R,{focusDistance:.3,focalLength:.6,bokehScale:3}),s=new W.g(R,c);return s.setDepthTexture(o.texture,D.RGBADepthPacking),{renderPass:r,savePass:new W.n(a),lambdaPassBefore:new W.h(T),lambdaPassAfter:new W.h(z),blurPass:s,depthPass:o}}),[e,t,T,R,N,_.outputEncoding]),L=F.renderPass,U=F.savePass,B=F.depthPass,V=F.blurPass,G=F.lambdaPassBefore,K=F.lambdaPassAfter,J=Object(a.useMemo)((function(){return H({savePass:U,textureMatrix:A})}),[U,A]);return[r,J,[G,L,B,V,U,K]]}(),t=Object(s.a)(e,3),n=t[0],r=t[1],o=t[2];return J(o),Object(l.jsx)("group",{"position-z":-5,children:Object(l.jsxs)("mesh",{receiveShadow:!0,ref:n,"rotation-x":-Math.PI/2,"position-y":-3.001,children:[Object(l.jsx)("planeBufferGeometry",{receiveShadow:!0,attach:"geometry",args:[300,300]}),Object(l.jsx)(r,{metalness:.8,roughness:.3,clearcoat:.5,reflectorOpacity:.3,args:[300,300]})]})})}function oe(e){var t=e.url,n=Object(a.useRef)(),r=Object(S.e)().camera,o=Object(a.useState)((function(){return new D.AudioListener})),c=Object(s.a)(o,1)[0],i=Object(S.d)(D.AudioLoader,t);return Object(a.useEffect)((function(){return n.current.setBuffer(i),n.current.setRefDistance(1),n.current.setLoop(!0),n.current.play(),r.add(c),function(){return r.remove(c)}})),Object(l.jsx)("positionalAudio",{ref:n,args:[c]})}function ce(e){var t=Object(a.useRef)();return Object(S.c)((function(e){var n=.5*e.clock.getElapsedTime();t.current&&t.current.children.forEach((function(e){e.rotation.x=.05*Math.sin(n),e.rotation.y=.05*Math.sin(n),e.rotation.z=.05*Math.sin(n)}))})),Object(l.jsx)("group",{"position-z":-5,children:Object(l.jsx)("group",{ref:t,children:Object(l.jsx)(ee,{imageUrls:e.props})})})}var se=function(e){Object(w.a)(n,e);var t=Object(y.a)(n);function n(e){var a;return Object(v.a)(this,n),(a=t.call(this,e)).callbackFunction=function(){a.setState({hasStream:!0})},a.state={imageUrls:a.props.imageUrls,hasStream:a.props.hasStream},a}return Object(g.a)(n,[{key:"componentDidMount",value:function(){console.log("canvas did mount",this.props.imageUrls.length)}},{key:"componentDidUpdate",value:function(){console.log("canvas did update",this.props.imageUrls.length)}},{key:"shouldComponentUpdate",value:function(e,t){return this.props.imageUrls.length!==e.imageUrls.length||this.props.loggedIn!==e.loggedIn||this.state.hasStream!==t.hasStream}},{key:"render",value:function(){return Object(l.jsxs)(l.Fragment,{children:[this.props.loggedIn&&Object(l.jsx)(X,{callbackFunction:this.callbackFunction}),Object(l.jsxs)(S.a,{id:"canvas",colorManagement:!0,shadowMap:!0,camera:{position:[0,0,10],far:100,near:.1,fov:60},resize:{debounce:{scroll:0,resize:0}},invalidateFrameloop:!0,gl:{powerPreference:"high-performance",antialias:!1,alpha:!1},style:{background:"black",position:"fixed",top:"0",bottom:"0",right:"0",left:"0",zIndex:"0"},children:[Object(l.jsx)(re,{}),Object(l.jsx)(ce,{props:this.state.imageUrls}),Object(l.jsx)("fogExp2",{attach:"fog",args:[12582909,.049]}),Object(l.jsx)("ambientLight",{intensity:.3}),Object(l.jsxs)(a.Suspense,{fallback:null,children:[Object(l.jsx)(oe,{url:"https://res.cloudinary.com/www-houseofkilling-com/video/upload/v1620900008/sounds/AliveForever_clhtnw.mp3"}),Object(l.jsx)(q,{position:[10,0,10],args:[7,32,32]}),Object(l.jsx)(q,{position:[-70,5,20],args:[3,32,32]}),Object(l.jsx)(q,{position:[50,10,-40],args:[10,32,32]}),Object(l.jsx)(q,{position:[0,0,0],args:[50,32,32]})]}),Object(l.jsx)(L.a,{files:"vr_landscape.hdr",background:!1}),Object(l.jsx)(T,{count:500,position:[0,0,0]}),Object(l.jsx)(T,{count:500,position:[-50,0,0]}),Object(l.jsx)(T,{count:500,position:[-50,0,20]}),Object(l.jsx)(k.a,{gravity:[0,0,0],children:Object(l.jsx)(N,{})}),Object(l.jsx)(ne,{}),this.state.hasStream&&Object(l.jsx)(ae,{}),Object(l.jsx)(U.a,{distance:45e4,sunPosition:[0,10,0],inclination:1,azimuth:.25})]}),Object(l.jsx)(B.a,{dataInterpolation:function(e){return"waking up ".concat(e.toFixed(5),"%")}})]})}}]),n}(r.a.Component),ie=n(108);function le(e){var t=Object(a.useState)("Drag 'n' drop some files here, or click to select files"),n=Object(s.a)(t,2),r=n[0],o=n[1],c=Object(a.useState)(!1),i=Object(s.a)(c,2),u=i[0],f=i[1],j=Object(a.useRef)(),m=Object(a.useCallback)((function(t){if(t[0]){var n=new FileReader;n.readAsDataURL(t[0]),n.onloadstart=function(){console.log("loads file"),o("loading file:"),f(!0)},n.onloadend=function(){console.log("has file"),e.uploadImage(n.result),n.error?o("that didnt go according to plan"):setTimeout((function(){o("thank you for your expression. i love it"),setTimeout((function(){o("Drag 'n' drop some files here, or click to select files"),f(!1)}),2e3),f(!1)}),1e3)}}}),[e]);return Object(l.jsx)(ie.a,{onDrop:m,accept:"image/*",minSize:1024,maxSize:3072e3,className:"container",children:function(e){var t=e.getRootProps,n=e.getInputProps;return Object(l.jsxs)("div",Object(M.a)(Object(M.a)({},t({className:"dropzone"})),{},{style:{width:"100%",height:"100%"},ref:j,children:[Object(l.jsx)("input",Object(M.a)({},n())),u?Object(l.jsx)("p",{children:"is loading"}):Object(l.jsx)("p",{children:r})]}))}})}var ue=function(e){Object(w.a)(n,e);var t=Object(y.a)(n);function n(e){var a;return Object(v.a)(this,n),(a=t.call(this,e)).loadImages=Object(x.a)(O.a.mark((function e(){var t,n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/getallimages");case 3:return t=e.sent,e.next=6,t.json();case 6:n=e.sent,a.setState({imageUrls:n.images}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("this is the output error",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),a.handleFileInputChange=function(e){var t=e.target.files[0];console.log(t),a.previewFile(t)},a.uploadImage=function(){var e=Object(x.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/upload",{method:"POST",body:JSON.stringify({data:t}),headers:{"Content-type":"application/json"}});case 3:return n=e.sent,e.next=6,n.json();case 6:r=e.sent,console.log("succesful upload",r),a.setState({hasNewImage:!0,previewSource:""}),a.props.socket.emit("uploadImage",{data:r},(function(e){})),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),a.state={imageUrls:[],hasNewImage:!0,previewSource:"",hasBroadcast:!1},a}return Object(g.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.loadImages(),this.setState({hasNewImage:!1}),this.props.socket.on("message",(function(t){t.newImage&&(e.state.imageUrls.includes(t.newImage)||e.setState({imageUrls:[].concat(Object(i.a)(e.state.imageUrls),[t.newImage])})),t.broadcast&&(console.log("has broadcast",t),e.setState({hasBroadcast:!0}))}))}},{key:"render",value:function(){return Object(l.jsxs)(l.Fragment,{children:[this.state.imageUrls.length>1?Object(l.jsx)(a.Suspense,{fallback:null,children:Object(l.jsx)(se,{imageUrls:this.state.imageUrls,loggedIn:this.props.loggedIn,hasBroadcast:this.state.hasBroadcast})}):null,this.props.loggedIn&&Object(l.jsx)(l.Fragment,{children:Object(l.jsxs)("div",{style:{position:"absolute",bottom:"0",left:"0",display:"flex",flexFlow:"column-reverse",zIndex:"99999999999",height:"150px",width:"250px"},className:"container",children:[Object(l.jsx)("p",{style:{position:"absolute",bottom:"105%",fontSize:"15px"},children:"Feed me expressions plz"}),Object(l.jsx)(le,{uploadImage:this.uploadImage})]})})]})}}]),n}(r.a.Component),fe=(n(138),n(106)),je=n(23),me=n(69),de=n.n(me);function pe(){var e=Object(a.useRef)(),t=Object(a.useRef)();function n(){return(n=Object(x.a)(O.a.mark((function e(){var n,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 3:n=e.sent,t.current.srcObject=n,a=r(),n.getTracks().forEach((function(e){return a.addTrack(e,n)})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function r(){var e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{url:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}]});return e.onnegotiationneeded=function(){return function(e){return o.apply(this,arguments)}(e)},e}function o(){return(o=Object(x.a)(O.a.mark((function e(t){var n,a,r,o,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createOffer();case 2:return n=e.sent,e.next=5,t.setLocalDescription(n);case 5:return a={sdp:t.localDescription},console.log("BROADCASTER SENDS",a),e.next=9,de.a.post("/api/broadcast",a);case 9:r=e.sent,o=r.data,c=new RTCSessionDescription(o.sdp),t.setRemoteDescription(c).catch((function(e){return console.log("there is an error",e)}));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(l.jsxs)("div",{style:{position:"absolute",top:"0",bottom:"0",right:"0",left:"0",zIndex:"10"},children:[Object(l.jsx)("button",{ref:e,id:"my-button",onClick:function(){return n.apply(this,arguments)},children:"Start Stream"}),Object(l.jsx)("button",{ref:e,id:"my-button",onClick:function(){de.a.post("/api/endbroadcast")},children:"End Stream"}),Object(l.jsx)("video",{ref:t,autoPlay:!0,controls:!0,id:"video"})]})}var be=n(105),he=n.n(be)()("https://stayvirtual-chat-backend.herokuapp.com/"),Oe=function(){var e=Object(a.useState)(),t=Object(s.a)(e,2),n=t[0],r=t[1],o=Object(a.useState)(),c=Object(s.a)(o,2),i=c[0],u=c[1],f=Object(a.useState)(),j=Object(s.a)(f,2),m=j[0],d=j[1],p=Object(a.useRef)();return Object(l.jsxs)(fe.a,{children:[Object(l.jsxs)(je.a,{path:"/",exact:!0,children:[!i&&Object(l.jsxs)(l.Fragment,{children:[Object(l.jsxs)("div",{className:"outer-container",style:{zIndex:"1"},children:[Object(l.jsx)("div",{className:"circletype-container",children:Object(l.jsxs)("p",{id:"circletype",children:["www.stayvirtual.online** softly introduces H r w a i l Archive of Human Expression* \xb7"," "]})}),Object(l.jsx)("div",{className:"container",children:Object(l.jsx)("input",{placeholder:"Name",className:"input",type:"text",ref:p})}),Object(l.jsx)("button",{onClick:function(e){r(p.current.value),function(e){var t=e;u(!0),he.emit("join",{name:t},(function(e){e&&(alert(e),u(!1))})),he.on("me",(function(e){d(e)}))}(p.current.value)},className:"sendButton",type:"submit",children:"Sign In"})]}),Object(l.jsxs)("p",{children:["* a generative encyclopedia of images as expressions. ",Object(l.jsx)("br",{}),"** an open source landscape ",Object(l.jsx)("br",{})," + live chat"]})]}),Object(l.jsxs)(a.Suspense,{fallback:null,children:[Object(l.jsx)(ue,{socket:he,loggedIn:i,name:n,myID:m}),Object(l.jsx)(b,{socket:he,loggedIn:i,name:n,myID:m})]})]}),Object(l.jsx)(je.a,{path:"/broadcast",exact:!0,children:Object(l.jsx)(pe,{socket:he})})]})};c.a.render(Object(l.jsx)(Oe,{}),document.getElementById("root"))}},[[186,1,2]]]);
//# sourceMappingURL=main.0c853af8.chunk.js.map