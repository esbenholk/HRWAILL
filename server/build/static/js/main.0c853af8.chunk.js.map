{"version":3,"sources":["components/TextContainer/TextContainer.js","icons/onlineIcon.png","components/Messages/Message/Message.js","components/Messages/Messages.js","components/Input/Input.js","components/Chat/Chat.js","components/playground/FPVControls.js","components/playground/useKeyboardControls.js","components/playground/Player.js","components/functions/firefly_material.js","components/functions/fireflies.js","components/functions/reflector-material.js","components/functions/use-postprocessing.js","components/Broadcast/Stream.js","components/content_redistribution/canvas.js","components/functions/use-reflector.js","components/content_redistribution/index.js","components/Broadcast/Broadcast.js","App.js","index.js"],"names":["TextContainer","users","className","style","position","top","zIndex","pointerEvents","maxWidth","display","flexDirection","whiteSpace","map","user","name","alt","src","Message","trimmedName","message","text","isSentByCurrentUser","trim","ReactEmoji","emojify","Messages","messages","messagesEndRef","useRef","useEffect","current","scrollIntoView","behavior","i","ref","Input","setMessage","sendMessage","type","placeholder","value","onChange","target","onKeyPress","event","key","onClick","e","Chat","props","socket","useState","setName","setUsers","setMessages","loggedIn","on","username","bottom","right","left","preventDefault","emit","extend","PointerLockControlsImpl","FPVControls","useThree","camera","gl","controls","document","getElementById","addEventListener","lock","args","domElement","actionByKey","KeyW","KeyS","KeyD","KeyA","ArrowUp","ArrowDown","ArrowRight","ArrowLeft","Space","Player","moveForward","moveBackward","moveLeft","moveRight","jump","movement","setMovement","handleKeyDown","code","state","handleKeyUp","removeEventListener","useKeyboardControls","useSphere","mass","api","velocity","subscribe","v","useFrame","copy","direction","Vector3","frontVector","sideVector","subVectors","normalize","multiplyScalar","applyEuler","rotation","Math","abs","toFixed","set","x","z","starter","Control","active","setActive","y","OrbitControls","autoRotate","autoRotateSpeed","maxZoom","minZoom","minDistance","maxDistance","maxPolarAngle","PI","FireflyMaterial","uniforms","uTime","uPixelRatio","min","window","devicePixelRatio","uSize","vertexShader","fragmentShader","this","THREE","Fireflies","count","shader","useMemo","positionArray","Float32Array","scaleArray","random","toArray","delta","time","attachObject","array","itemSize","transparent","depthWrite","ReflectorMaterialImpl","parameters","setValues","_flowMapOffset0","_flowMapOffset1","_tDiffuse","_tNormalMap0","_tNormalMap1","_textureMatrix","_reflectorOpacity","flowMapOffset0","flowMapOffset1","tDiffuse","tNormalMap0","tNormalMap1","textureMatrix","reflectorOpacity","replace","MeshPhysicalMaterial","ReflectorMaterial","savePass","React","forwardRef","material","textures","useTexture","water","forEach","wrapS","wrapT","RepeatWrapping","repeat","clock","getDelta","cycle","object","attach","renderTarget","texture","side","DoubleSide","aoMap","myMap","displacementMap","displacementScale","normalMap","normalScale","roughnessMap","usePostprocessing","reflectorPipeline","size","scene","smaa","useLoader","SMAAImageLoader","composer","EffectComposer","frameBufferType","multisampling","renderPass","RenderPass","CHROMATIC_ABERRATION","ChromaticAberrationEffect","offset","BLOOM","BloomEffect","luminanceSmoothing","intensity","NOISE","NoiseEffect","blendFunction","BlendFunction","COLOR_DODGE","blendMode","opacity","SMAA","SMAAEffect","edgeDetectionMaterial","setEdgeDetectionThreshold","setPredicationMode","PredicationMode","DEPTH","setPredicationThreshold","setPredicationScale","edgesTextureEffect","TextureEffect","SKIP","renderTargetEdges","weightsTextureEffect","renderTargetWeights","effectPass","EffectPass","effectPassChroAbb","pass","addPass","setSize","width","height","_","render","streamUrl","Stream","hasStream","setHasStream","stream","url","http","XMLHttpRequest","open","send","status","UrlExists","callbackFunction","playing","disablePictureInPicture","id","objectFit","RSphere","WebGLCubeRenderTarget","cubeRenderTarget","update","MeshWobbleMaterial","color","envMap","factor","speed","roughness","metalness","distort","randomIntFromInterval","max","floor","Cubes","imageUrls","imageUrl","index","castShadow","receiveShadow","fallback","softShadows","ImageTextureMaterial","TextureLoader","Lights","lightRef","lightRef1","t","getElapsedTime","sin","cos","angle","penumbra","shadow-mapSize-width","shadow-mapSize-height","StreamBoxes","vid","getElementsByTagName","crossOrigin","video","groupRef","Floor","textureWidth","textureHeight","clipBias","meshRef","Plane","reflectorPlane","normal","reflectorWorldPosition","cameraWorldPosition","Matrix4","rotationMatrix","lookAtPosition","Vector4","clipPlane","view","q","PerspectiveCamera","virtualCamera","renderer","beforeRender","useCallback","visible","setFromMatrixPosition","matrixWorld","extractRotation","applyMatrix4","dot","reflect","negate","add","up","lookAt","far","updateMatrixWorld","projectionMatrix","multiply","matrixWorldInverse","setFromNormalAndCoplanarPoint","constant","sign","elements","w","afterRender","minFilter","LinearFilter","magFilter","format","RGBFormat","WebGLRenderTarget","encoding","outputEncoding","MathUtils","isPowerOfTwo","generateMipmaps","depthPass","DepthPass","dof","DepthOfFieldEffect","focusDistance","focalLength","bokehScale","blurPass","setDepthTexture","RGBADepthPacking","SavePass","lambdaPassBefore","LambdaPass","lambdaPassAfter","Material","useReflector","passes","position-z","rotation-x","position-y","clearcoat","Sound","sound","AudioListener","listener","buffer","AudioLoader","setBuffer","setRefDistance","setLoop","play","remove","Boxes","children","element","ContentRedistributionCanvas","setState","console","log","length","nextProps","nextState","colorManagement","shadowMap","near","fov","resize","debounce","scroll","invalidateFrameloop","powerPreference","antialias","alpha","background","Environment","files","gravity","Sky","distance","sunPosition","inclination","azimuth","Loader","dataInterpolation","p","Component","MyDropzone","isLoading","setIsLoading","inputField","handleDrop","acceptedFiles","reader","FileReader","readAsDataURL","onloadstart","onloadend","uploadImage","result","error","setTimeout","onDrop","accept","minSize","maxSize","getRootProps","getInputProps","ContentRedistribution","loadImages","a","fetch","res","json","data","images","handleFileInputChange","file","previewFile","base64EncodedImage","method","body","JSON","stringify","headers","hasNewImage","previewSource","hasBroadcast","newImage","includes","broadcast","flexFlow","fontSize","Broadcast","button","navigator","mediaDevices","getUserMedia","audio","srcObject","peer","createPeer","getTracks","track","addTrack","RTCPeerConnection","iceServers","urls","credential","onnegotiationneeded","handleNegotiationNeededEvent","createOffer","offer","setLocalDescription","payload","sdp","localDescription","axios","post","desc","RTCSessionDescription","setRemoteDescription","catch","autoPlay","io","App","setLoggedIn","myID","setMyID","nameRef","path","exact","alert","runConnection","ReactDOM"],"mappings":"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","file":"static/js/main.0c853af8.chunk.js","sourcesContent":["import React from \"react\";\n\nimport onlineIcon from \"../../icons/onlineIcon.png\";\n\nimport \"./TextContainer.css\";\n\nfunction TextContainer({ users }) {\n  const HWRAILL_Text =\n    \"THE HRWAILL ARCHIVE of Human Expressions is a user generated data set that unfolds into a 3D landscape. \\nPlay as data input for the semi-sentient machine learning algorithm HRWAILL and enjoy First Person Shooter access to its slowly expanding index of signs, images and symbols. \\nClick on landscape to toggle controls AWSD \\nClick ESC to reclaim control of your cursor\";\n  return (\n    <div\n      className=\"container\"\n      style={{\n        position: \"fixed\",\n        top: \"200px\",\n        zIndex: \"99999\",\n        pointerEvents: \"auto\",\n        maxWidth: \"250px\",\n        display: \"flex\",\n        flexDirection: \"column\",\n      }}\n    >\n      {users ? (\n        <div>\n          <p style={{ whiteSpace: \"pre-wrap\" }}>{HWRAILL_Text}</p>\n\n          <p className=\"users-headline\">Online users</p>\n          <div className=\"users\">\n            {users.map((user) => (\n              <div key={user.name} className=\"activeItem\">\n                <p>{user.name}</p>\n                <img alt=\"Online Icon\" src={onlineIcon} />\n              </div>\n            ))}\n          </div>\n        </div>\n      ) : null}\n    </div>\n  );\n}\n\nexport default TextContainer;\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAGCAYAAADgzO9IAAAAAXNSR0IArs4c6QAAAExJREFUCB1jbPh/le3lx5tNDIwMcQwg8J9hkTi/eh0LWJCBoRwoAAPlQDEGJrhKmDCIBupmQuYjs5lAZiILgNlAMRaQRSAz4UZCLQcAIwYaiAejKoYAAAAASUVORK5CYII=\"","import React from \"react\";\n\nimport ReactEmoji from \"react-emoji\";\n\nconst Message = ({ message: { text, user }, name }) => {\n  let isSentByCurrentUser = false;\n\n  let trimmedName;\n\n  if (name) {\n    trimmedName = name.trim();\n  }\n\n  if (user === trimmedName) {\n    isSentByCurrentUser = true;\n  }\n\n  return isSentByCurrentUser ? (\n    <div className=\"messageContainer justifyEnd\">\n      <p className=\"sentText pr-10\">{trimmedName}</p>\n      <p className=\"messageText\">{ReactEmoji.emojify(text)}</p>\n    </div>\n  ) : (\n    <div className=\"messageContainer justifyEnd\">\n      <p className=\"sentText pl-10 \">{user}</p>\n\n      <p className=\"messageText\">{ReactEmoji.emojify(text)}</p>\n    </div>\n  );\n};\n\nexport default Message;\n","import React, { useRef, useEffect } from \"react\";\n\nimport Message from \"./Message/Message\";\n\nfunction Messages({ messages, name }) {\n  const messagesEndRef = useRef(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  useEffect(scrollToBottom, [messages]);\n\n  return (\n    <div className=\"messages\" style={{ pointerEvents: \"auto\" }}>\n      {messages.map((message, i) => (\n        <div key={i}>\n          <Message message={message} name={name} />\n        </div>\n      ))}\n      <div ref={messagesEndRef} />\n    </div>\n  );\n}\n\nexport default Messages;\n","import React from \"react\";\n\nimport \"./Input.css\";\n\nconst Input = ({ setMessage, sendMessage, message }) => (\n  <form className=\"form\">\n    <input\n      className=\"input\"\n      type=\"text\"\n      placeholder=\"Type a message...\"\n      value={message}\n      onChange={({ target: { value } }) => setMessage(value)}\n      onKeyPress={(event) =>\n        event.key === \"Enter\" ? sendMessage(event) : null\n      }\n    />\n    <button className=\"sendButton\" onClick={(e) => sendMessage(e)}>\n      Send\n    </button>\n  </form>\n);\n\nexport default Input;\n","import React, { useState, useEffect } from \"react\";\n\n// import VideoChat from \"../TextContainer/VideoChat.js\";\n// <VideoChat\n// users={users}\n// socket={socket}\n// id={props.myID}\n// myName={props.name}\n// />\nimport TextContainer from \"../TextContainer/TextContainer.js\";\nimport Messages from \"../Messages/Messages\";\nimport Input from \"../Input/Input\";\n\nconst Chat = (props) => {\n  const socket = props.socket;\n\n  const [name, setName] = useState();\n  const [users, setUsers] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const [messages, setMessages] = useState([]);\n\n  useEffect(() => {\n    if (props.loggedIn) {\n      socket.on(\"message\", (message) => {\n        setMessages((messages) => [...messages, message]);\n      });\n\n      socket.on(\"roomData\", ({ users, username }) => {\n        setUsers(users);\n        setName(username);\n      });\n    }\n  }, [props.loggedIn, socket]);\n\n  const sendMessage = (event) => {\n    event.preventDefault();\n\n    if (message) {\n      socket.emit(\"sendMessage\", message, () => setMessage(\"\"));\n    }\n  };\n\n  return (\n    <div\n      style={{\n        position: \"absolute\",\n        top: \"0\",\n        bottom: \"0\",\n        right: \"0\",\n        left: \"0\",\n        zIndex: \"0\",\n        pointerEvents: \"none\",\n      }}\n    >\n      {props.loggedIn && (\n        <>\n          <div\n            className=\"chatContainer containerframe\"\n            style={{ pointerEvents: \"auto\" }}\n          >\n            <Messages messages={messages} name={name} />\n            <Input\n              message={message}\n              setMessage={setMessage}\n              sendMessage={sendMessage}\n            />\n          </div>\n\n          <TextContainer users={users} />\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default Chat;\n","import React, { useEffect } from \"react\";\nimport { PointerLockControls as PointerLockControlsImpl } from \"three/examples/jsm/controls/PointerLockControls\";\nimport { useThree, extend } from \"@react-three/fiber\";\nimport { useRef } from \"react\";\n\nextend({ PointerLockControlsImpl });\n\nexport const FPVControls = (props) => {\n  const { camera, gl } = useThree();\n  const controls = useRef();\n\n  useEffect(() => {\n    document.getElementById(\"canvas\").addEventListener(\"click\", () => {\n      if (controls.current) {\n        controls.current.lock();\n      }\n    });\n  }, []);\n\n  return (\n    <>\n      <pointerLockControlsImpl\n        ref={controls}\n        args={[camera, gl.domElement]}\n        {...props}\n      />\n    </>\n  );\n};\n","import { useState, useEffect } from \"react\";\n\nfunction actionByKey(key) {\n  const keys = {\n    KeyW: \"moveForward\",\n    KeyS: \"moveBackward\",\n    KeyD: \"moveRight\",\n    KeyA: \"moveLeft\",\n    ArrowUp: \"moveForward\",\n    ArrowDown: \"moveBackward\",\n    ArrowRight: \"moveRight\",\n    ArrowLeft: \"moveLeft\",\n    Space: \"jump\",\n  };\n  return keys[key];\n}\n\nexport const useKeyboardControls = () => {\n  const [movement, setMovement] = useState({\n    moveForward: false,\n    moveBackward: false,\n    moveLeft: false,\n    moveRight: false,\n    jump: false,\n  });\n\n  useEffect(() => {\n    const handleKeyDown = (e) => {\n      // Movement key\n      if (actionByKey(e.code)) {\n        setMovement((state) => ({\n          ...state,\n          [actionByKey(e.code)]: true,\n        }));\n      }\n    };\n    const handleKeyUp = (e) => {\n      if (actionByKey(e.code)) {\n        setMovement((state) => ({\n          ...state,\n          [actionByKey(e.code)]: false,\n        }));\n      }\n    };\n\n    document.addEventListener(\"keydown\", handleKeyDown);\n    document.addEventListener(\"keyup\", handleKeyUp);\n\n    return () => {\n      document.removeEventListener(\"keydown\", handleKeyDown);\n      document.removeEventListener(\"keyup\", handleKeyUp);\n    };\n  }, []);\n\n  return movement;\n};\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { useSphere } from \"@react-three/cannon\";\nimport { useThree, useFrame } from \"@react-three/fiber\";\nimport { FPVControls } from \"./FPVControls\";\nimport { useKeyboardControls } from \"./useKeyboardControls\";\nimport { Vector3 } from \"three\";\nimport { OrbitControls } from \"@react-three/drei\";\n\nconst SPEED = 6;\n\nconst Player = (props) => {\n  const { camera } = useThree();\n\n  let { moveForward, moveBackward, moveLeft, moveRight, jump } =\n    useKeyboardControls();\n\n  const [ref, api] = useSphere(() => ({\n    mass: 1,\n    type: \"Dynamic\",\n    ...props,\n  }));\n\n  const velocity = useRef([0, 0, 0]);\n  useEffect(() => {\n    api.velocity.subscribe((v) => (velocity.current = v));\n  }, [api.velocity]);\n\n  useFrame(() => {\n    camera.position.copy(ref.current.position);\n    const direction = new Vector3();\n\n    const frontVector = new Vector3(\n      0,\n      0,\n      (moveBackward ? 1 : 0) - (moveForward ? 1 : 0)\n    );\n    const sideVector = new Vector3(\n      (moveLeft ? 1 : 0) - (moveRight ? 1 : 0),\n      0,\n      0\n    );\n\n    direction\n      .subVectors(frontVector, sideVector)\n      .normalize()\n      .multiplyScalar(SPEED)\n      .applyEuler(camera.rotation);\n\n    if (jump && Math.abs(velocity.current[1].toFixed(2)) < 0.05) {\n      api.velocity.set(velocity.current[0], 2, velocity.current[2]);\n\n      // setTimeout(function () {\n      //   console.log(\"stops jump\");\n\n      //   api.velocity.set(\n      //     velocity.current[0],\n      //     velocity.current[1],\n      //     velocity.current[2]\n      //   );\n      // }, 500); //wait 2 seconds\n\n      jump = false;\n    }\n    api.velocity.set(direction.x, velocity.current[1], direction.z);\n  });\n  return (\n    <>\n      <FPVControls starter={props.starter} />\n      <mesh ref={ref} />\n    </>\n  );\n};\n\nexport const Control = (props) => {\n  const [active, setActive] = useState(false);\n  const { camera } = useThree();\n\n  useEffect(() => {\n    document.getElementById(\"canvas\").addEventListener(\"click\", () => {\n      if (!active) {\n        setActive(true);\n      }\n    });\n  }, [active]);\n\n  return (\n    <>\n      {active ? (\n        <Player position={[camera.position.x, 1, camera.position.y]} />\n      ) : (\n        <>\n          <OrbitControls\n            autoRotate\n            autoRotateSpeed={(-60 * 0.15) / 5}\n            maxZoom={30}\n            minZoom={10}\n            minDistance={10}\n            maxDistance={50}\n            maxPolarAngle={Math.PI / 2 - 0.1}\n          />\n        </>\n      )}\n    </>\n  );\n};\n","import * as THREE from \"three\";\r\nimport { extend } from \"@react-three/fiber\";\r\n\r\nexport default class FireflyMaterial extends THREE.ShaderMaterial {\r\n  constructor() {\r\n    super({\r\n      uniforms: {\r\n        uTime: { value: 0 },\r\n        uPixelRatio: { value: Math.min(window.devicePixelRatio, 2) },\r\n        uSize: { value: 150 },\r\n      },\r\n      vertexShader: `\r\n      uniform float uPixelRatio;\r\n      uniform float uSize;\r\n      uniform float uTime;\r\n      attribute float aScale;    \r\n      void main() {\r\n        vec4 modelPosition = modelMatrix * vec4(position, 1.0);\r\n        modelPosition.y += sin(uTime + modelPosition.x * 100.0) * aScale * 0.2;\r\n        modelPosition.z += cos(uTime + modelPosition.x * 100.0) * aScale * 0.2;\r\n        modelPosition.x += cos(uTime + modelPosition.x * 100.0) * aScale * 0.2;\r\n        vec4 viewPosition = viewMatrix * modelPosition;\r\n        vec4 projectionPostion = projectionMatrix * viewPosition;    \r\n        gl_Position = projectionPostion;\r\n        gl_PointSize = uSize * aScale * uPixelRatio;\r\n        gl_PointSize *= (1.0 / - viewPosition.z);\r\n      }`,\r\n      fragmentShader: `\r\n      void main() {\r\n        float distanceToCenter = distance(gl_PointCoord, vec2(0.5));\r\n        float strength = 0.05 / distanceToCenter - 0.1;\r\n        gl_FragColor = vec4(1.0, 1.0, 1.0, strength);\r\n      }`,\r\n    });\r\n  }\r\n\r\n  get time() {\r\n    return this.uniforms.uTime.value;\r\n  }\r\n\r\n  set time(v) {\r\n    this.uniforms.uTime.value = v;\r\n  }\r\n}\r\n\r\nextend({ FireflyMaterial });\r\n","import * as THREE from \"three\";\r\nimport React, { useRef, useMemo } from \"react\";\r\nimport { useFrame } from \"@react-three/fiber\";\r\nimport \"./firefly_material\";\r\n\r\nexport default function Fireflies({ count, position }) {\r\n  const shader = useRef();\r\n  const [positionArray, scaleArray] = useMemo(() => {\r\n    const positionArray = new Float32Array(count * 3);\r\n    const scaleArray = new Float32Array(count);\r\n    for (let i = 0; i < count; i++) {\r\n      new THREE.Vector3(\r\n        (Math.random() - 0.5) * 100,\r\n        Math.random() * 1.5,\r\n        (Math.random() - 0.5) * 100\r\n      ).toArray(positionArray, i * 3);\r\n      scaleArray[i] = Math.random();\r\n    }\r\n    return [positionArray, scaleArray];\r\n  }, [count]);\r\n  useFrame((state, delta) => (shader.current.time += delta / 2));\r\n  return (\r\n    <mesh position={position}>\r\n      <points key={count}>\r\n        <bufferGeometry>\r\n          <bufferAttribute\r\n            attachObject={[\"attributes\", \"position\"]}\r\n            count={count}\r\n            array={positionArray}\r\n            itemSize={3}\r\n          />\r\n          <bufferAttribute\r\n            attachObject={[\"attributes\", \"aScale\"]}\r\n            count={count}\r\n            array={scaleArray}\r\n            itemSize={1}\r\n          />\r\n        </bufferGeometry>\r\n        <fireflyMaterial ref={shader} transparent depthWrite={false} />\r\n      </points>\r\n    </mesh>\r\n  );\r\n}\r\n","import { useTexture } from \"@react-three/drei\";\nimport React, { useEffect, useState } from \"react\";\nimport { useFrame } from \"@react-three/fiber\";\nimport { MeshPhysicalMaterial, DoubleSide, RepeatWrapping } from \"three\";\n\nclass ReflectorMaterialImpl extends MeshPhysicalMaterial {\n  _flowMapOffset0;\n  _flowMapOffset1;\n  _tDiffuse;\n  _textureMatrix;\n  _reflectorOpacity;\n  _tNormalMap0;\n  _tNormalMap1;\n  constructor(parameters = {}) {\n    super(parameters);\n    this.setValues(parameters);\n    this._flowMapOffset0 = { value: null };\n    this._flowMapOffset1 = { value: null };\n    this._tDiffuse = { value: null };\n    this._tNormalMap0 = { value: null };\n    this._tNormalMap1 = { value: null };\n    this._textureMatrix = { value: null };\n    this._reflectorOpacity = { value: 0.2 };\n  }\n\n  onBeforeCompile(shader) {\n    shader.uniforms.flowMapOffset0 = this._flowMapOffset0;\n    shader.uniforms.flowMapOffset1 = this._flowMapOffset1;\n    shader.uniforms.tDiffuse = this._tDiffuse;\n    shader.uniforms.tNormalMap0 = this._tNormalMap0;\n    shader.uniforms.tNormalMap1 = this._tNormalMap1;\n    shader.uniforms.textureMatrix = this._textureMatrix;\n    shader.uniforms.reflectorOpacity = this._reflectorOpacity;\n\n    shader.vertexShader = `\n        uniform mat4 textureMatrix;\n        varying vec4 my_vUv;\n     \n      ${shader.vertexShader}\n    `;\n    shader.vertexShader = shader.vertexShader.replace(\n      \"#include <project_vertex>\",\n      `\n        #include <project_vertex>\n        my_vUv = textureMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        `\n    );\n\n    shader.fragmentShader = `\n        uniform sampler2D tDiffuse;\n        uniform float flowMapOffset0;\n        uniform float flowMapOffset1;\n        uniform float reflectorOpacity;\n        uniform sampler2D tNormalMap0;\n        uniform sampler2D tNormalMap1;\n        varying vec4 my_vUv;\n        ${shader.fragmentShader}\n    `;\n    shader.fragmentShader = shader.fragmentShader.replace(\n      \"#include <map_fragment>\",\n      `\n        #include <map_fragment>\n\n        float halfCycle = 1.0/2.0;\n        float scale = 1.0;\n        vec3 toEye = normalize( vec3(1.0,1.0,0.0) );\n        \n        // determine flow direction\n        vec2 flow = vec2(0.8,0.3);\n        flow.x *= - 1.0;\n        \n        // sample normal maps (distort uvs with flowdata)\n        vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );\n        vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );\n        \n        // linear interpolate to get the final normal color\n        float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;\n        vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );\n        \n        // calculate normal vector\n        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n        \n        // calculate the fresnel term to blend reflection and refraction maps\n        float theta = max( dot( toEye, my_normal ), 0.0 );\n        float reflectance = 1.0 + ( 1.0 - 1.0 ) * pow( ( 1.0 - theta ), 5.0 );\n        \n        // calculate final uv coords\n        vec3 coord = my_vUv.xyz / my_vUv.w;\n        vec2 uv = coord.xy + coord.z * my_normal.xz * 0.05;\n        \n        vec4 myTexelRoughness = texture2D( roughnessMap, vUv );\n        vec4 baseWater = texture2D( tDiffuse, uv);\n        vec4 base = texture2DProj( tDiffuse, my_vUv );\n        vec4 mixedBase = mix(base, baseWater, myTexelRoughness.r > 0.5 ? 0.0 : 1.0);\n        mixedBase *= 1.0 - myTexelRoughness.r;\n        diffuseColor.rgb += reflectorOpacity * mixedBase.rgb;\n      `\n    );\n  }\n\n  get flowMapOffset0() {\n    return this._flowMapOffset0.value;\n  }\n  set flowMapOffset0(v) {\n    this._flowMapOffset0.value = v;\n  }\n  get flowMapOffset1() {\n    return this._flowMapOffset1.value;\n  }\n  set flowMapOffset1(v) {\n    this._flowMapOffset1.value = v;\n  }\n  get tDiffuse() {\n    return this._tDiffuse.value;\n  }\n  set tDiffuse(v) {\n    this._tDiffuse.value = v;\n  }\n  get tNormalMap0() {\n    return this._tNormalMap0.value;\n  }\n  set tNormalMap0(v) {\n    this._tNormalMap0.value = v;\n  }\n  get tNormalMap1() {\n    return this._tNormalMap1.value;\n  }\n  set tNormalMap1(v) {\n    this._tNormalMap1.value = v;\n  }\n  get textureMatrix() {\n    return this._textureMatrix.value;\n  }\n  set textureMatrix(v) {\n    this._textureMatrix.value = v;\n  }\n  get reflectorOpacity() {\n    return this._reflectorOpacity.value;\n  }\n  set reflectorOpacity(v) {\n    this._reflectorOpacity.value = v;\n  }\n}\n\nexport const ReflectorMaterial = ({ savePass, textureMatrix }) =>\n  React.forwardRef((props, ref) => {\n    const [material] = useState(() => new ReflectorMaterialImpl());\n    const cycle = 1.0;\n    const halfCycle = cycle / 2;\n    const flowSpeed = 10;\n\n    const textures = useTexture([\n      \"/BASE.jpg\",\n      \"/AO.jpg\",\n      \"/HEIGHT.png\",\n      \"/NORMAL.jpg\",\n      \"/ROUGHNESS.jpg\",\n    ]);\n    const water = useTexture([\"/Water_2.jpg\", \"/Water_2.jpg\"]);\n    useEffect(() => {\n      textures.forEach((x) => {\n        x.wrapS = x.wrapT = RepeatWrapping;\n        x.repeat.set(1, 1);\n      });\n      water.forEach((x) => {\n        x.wrapS = x.wrapT = RepeatWrapping;\n        x.repeat.set(1, 1);\n      });\n    }, [textures, water]);\n\n    useFrame(({ clock }) => {\n      if (material) {\n        const delta = clock.getDelta();\n        material.flowMapOffset0 += flowSpeed * delta;\n        material.flowMapOffset1 = material.flowMapOffset0 + halfCycle;\n        if (material.flowMapOffset0 >= cycle) {\n          material.flowMapOffset0 = 0;\n          material.flowMapOffset1 = halfCycle;\n        } else if (material.flowMapOffset1 >= cycle) {\n          material.flowMapOffset1 = material.flowMapOffset1 - cycle;\n        }\n      }\n    });\n    return (\n      <primitive\n        object={material}\n        ref={ref}\n        attach=\"material\"\n        {...props}\n        textureMatrix={textureMatrix}\n        tDiffuse={savePass.renderTarget.texture}\n        side={DoubleSide}\n        map={textures[0]}\n        aoMap={textures[1]}\n        myMap={textures[2]}\n        displacementMap={textures[2]}\n        displacementScale={0.5}\n        normalMap={textures[3]}\n        normalScale={[0.7, 0.7]}\n        roughnessMap={textures[4]}\n        tNormalMap0={water[0]}\n        tNormalMap1={water[1]}\n      />\n    );\n  });\n","import { useFrame, useThree, useLoader } from \"@react-three/fiber\";\nimport * as THREE from \"three\";\nimport { useEffect, useMemo } from \"react\";\nimport {\n  EffectComposer,\n  RenderPass,\n  EffectPass,\n  BlendFunction,\n  ChromaticAberrationEffect,\n  BloomEffect,\n  NoiseEffect,\n  PredicationMode,\n  SMAAEffect,\n  SMAAImageLoader,\n  TextureEffect,\n} from \"postprocessing\";\n\nfunction usePostprocessing(reflectorPipeline = []) {\n  const { gl, size, scene, camera } = useThree();\n  const smaa = useLoader(SMAAImageLoader);\n\n  const [composer] = useMemo(() => {\n    const composer = new EffectComposer(gl, {\n      frameBufferType: THREE.HalfFloatType,\n      multisampling: 0,\n    });\n    const renderPass = new RenderPass(scene, camera);\n\n    const CHROMATIC_ABERRATION = new ChromaticAberrationEffect({\n      offset: new THREE.Vector2(0.001, 0.001),\n    });\n    const BLOOM = new BloomEffect({\n      luminanceSmoothing: 0.3,\n      intensity: 0.5,\n    });\n    const NOISE = new NoiseEffect({\n      blendFunction: BlendFunction.COLOR_DODGE,\n    });\n    NOISE.blendMode.opacity.value = 0.03;\n\n    // INIT ANTIALIAS\n    const SMAA = new SMAAEffect(...smaa);\n    SMAA.edgeDetectionMaterial.setEdgeDetectionThreshold(0.05);\n    SMAA.edgeDetectionMaterial.setPredicationMode(PredicationMode.DEPTH);\n    SMAA.edgeDetectionMaterial.setPredicationThreshold(0.002);\n    SMAA.edgeDetectionMaterial.setPredicationScale(1.0);\n    const edgesTextureEffect = new TextureEffect({\n      blendFunction: BlendFunction.SKIP,\n      texture: SMAA.renderTargetEdges.texture,\n    });\n    const weightsTextureEffect = new TextureEffect({\n      blendFunction: BlendFunction.SKIP,\n      texture: SMAA.renderTargetWeights.texture,\n    });\n    // END ANTIALIAS\n\n    const effectPass = new EffectPass(\n      camera,\n      SMAA,\n      edgesTextureEffect,\n      weightsTextureEffect,\n      BLOOM,\n      NOISE\n    );\n    const effectPassChroAbb = new EffectPass(camera, CHROMATIC_ABERRATION);\n\n    reflectorPipeline.forEach((pass) => composer.addPass(pass));\n\n    composer.addPass(renderPass);\n    composer.addPass(effectPass);\n    composer.addPass(effectPassChroAbb);\n\n    return [composer];\n  }, [gl, scene, camera, reflectorPipeline, smaa]);\n\n  useEffect(\n    () => void composer.setSize(size.width, size.height),\n    [composer, size]\n  );\n  useFrame((_, delta) => void composer.render(delta), -1);\n}\n\nexport default usePostprocessing;\n","import React, { useEffect, useRef, useState } from \"react\";\r\nimport ReactPlayer from \"react-player\";\r\nconst streamUrl =\r\n  \"https://9080d9c066cb.eu-west-1.playback.live-video.net/api/video/v1/eu-west-1.554958627116.channel.DTf3HzFPw6Tl.m3u8\";\r\n\r\nexport default function Stream(props) {\r\n  const [hasStream, setHasStream] = useState(false);\r\n  const stream = useRef();\r\n  useEffect(() => {\r\n    UrlExists(streamUrl);\r\n    if (stream.current) {\r\n      props.callbackFunction();\r\n    }\r\n  }, [stream, props]);\r\n\r\n  function UrlExists(url) {\r\n    var http = new XMLHttpRequest();\r\n    http.open(\"HEAD\", url, false);\r\n    http.send();\r\n    if (http.status !== 404) {\r\n      setHasStream(true);\r\n    } else {\r\n      setHasStream(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className=\"container\"\r\n      style={{\r\n        position: \"fixed\",\r\n        top: \"0\",\r\n        left: \"0\",\r\n        zIndex: \"99999\",\r\n        pointerEvents: \"auto\",\r\n        width: \"250px\",\r\n        height: \"180px\",\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n      }}\r\n    >\r\n      {hasStream ? (\r\n        <ReactPlayer\r\n          ref={stream}\r\n          url={streamUrl}\r\n          width=\"100%\"\r\n          height=\"105%\"\r\n          playing\r\n          controls\r\n          disablePictureInPicture\r\n          id=\"video\"\r\n        />\r\n      ) : (\r\n        <img\r\n          style={{ height: \"100%\", objectFit: \"contain\" }}\r\n          src=\"https://res.cloudinary.com/www-houseofkilling-com/image/upload/w_1000,ar_1:1,c_fill,g_auto,e_art:hokusai/v1622725933/contentRedistribution/hrwail1_zgguct.png\"\r\n          alt=\"HRWAILL_icon\"\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { Suspense, useRef, useState, useEffect } from \"react\";\r\nimport { Canvas, useLoader, useFrame, useThree } from \"@react-three/fiber\";\r\n\r\nimport { Control } from \"../playground/Player\";\r\nimport { Physics } from \"@react-three/cannon\";\r\n\r\nimport Fireflies from \"../functions/fireflies\";\r\n\r\nimport {\r\n  softShadows,\r\n  Loader,\r\n  Environment,\r\n  Sky,\r\n  MeshWobbleMaterial,\r\n} from \"@react-three/drei\";\r\nimport { useReflector } from \"../functions/use-reflector\";\r\nimport usePostprocessing from \"../functions/use-postprocessing\";\r\n\r\nimport {\r\n  TextureLoader,\r\n  WebGLCubeRenderTarget,\r\n  AudioListener,\r\n  AudioLoader,\r\n} from \"three\";\r\n\r\nimport Stream from \"../Broadcast/Stream\";\r\nsoftShadows();\r\n\r\nfunction RSphere(props) {\r\n  const camera = useRef();\r\n  const { scene, gl } = useThree();\r\n  const [cubeRenderTarget] = useState(() => new WebGLCubeRenderTarget(256));\r\n  useFrame(() => camera.current.update(gl, scene));\r\n  return (\r\n    <mesh position={props.position}>\r\n      <cubeCamera ref={camera} args={[1, 1000, cubeRenderTarget]} />\r\n      <mesh>\r\n        <sphereBufferGeometry args={props.args} />\r\n        <MeshWobbleMaterial\r\n          attach=\"material\"\r\n          color=\"black\"\r\n          envMap={cubeRenderTarget.texture}\r\n          factor={2} // Strength, 0 disables the effect (default=1)\r\n          speed={0.6} // Speed (default=1)\r\n          roughness={0}\r\n          metalness={10}\r\n          distort={0}\r\n          side={2}\r\n        />\r\n      </mesh>\r\n    </mesh>\r\n  );\r\n}\r\n\r\nfunction randomIntFromInterval(min, max) {\r\n  // min and max included\r\n  return Math.floor(Math.random() * (max - min + 1) + min);\r\n}\r\n\r\nfunction Cubes({ imageUrls, material }) {\r\n  const ref = useRef();\r\n\r\n  return imageUrls.map((imageUrl, index) => (\r\n    <mesh\r\n      key={index}\r\n      ref={ref}\r\n      position={[\r\n        randomIntFromInterval(-50, 50),\r\n        Math.floor(Math.random() * 10),\r\n        randomIntFromInterval(-50, 50),\r\n      ]}\r\n      castShadow\r\n      receiveShadow\r\n    >\r\n      <boxBufferGeometry attach=\"geometry\" args={[5, 5, 5]} color=\"white\" />\r\n      <Suspense fallback={null}>\r\n        <ImageTextureMaterial imageUrl={imageUrl} material={material} />\r\n      </Suspense>\r\n    </mesh>\r\n  ));\r\n}\r\n\r\nconst ImageTextureMaterial = (imageUrl, material) => {\r\n  const texture = useLoader(TextureLoader, imageUrl.imageUrl);\r\n\r\n  return (\r\n    <meshStandardMaterial\r\n      attach=\"material\"\r\n      roughness={1}\r\n      color=\"white\"\r\n      map={texture}\r\n      material={material}\r\n    />\r\n  );\r\n};\r\n\r\nfunction Lights() {\r\n  const lightRef = useRef();\r\n  const lightRef1 = useRef();\r\n\r\n  useFrame(({ clock }) => {\r\n    const t = clock.getElapsedTime() * 0.5;\r\n    if (lightRef.current && lightRef1.current) {\r\n      lightRef.current.position.x = Math.sin(t) * 50;\r\n      lightRef1.current.position.x = Math.sin(t) * 50;\r\n\r\n      lightRef.current.position.z = Math.cos(t) * 50;\r\n      lightRef1.current.position.z = Math.sin(t) * 50;\r\n\r\n      lightRef1.current.position.y = Math.sin(t) * 50;\r\n    }\r\n  });\r\n\r\n  return (\r\n    <>\r\n      <spotLight\r\n        ref={lightRef}\r\n        position={[20, 20, 10]}\r\n        intensity={3}\r\n        castShadow\r\n        color=\"#00e9ff\"\r\n        angle={Math.PI / 3}\r\n        penumbra={1}\r\n        shadow-mapSize-width={1024}\r\n        shadow-mapSize-height={1024}\r\n      />\r\n\r\n      <spotLight\r\n        ref={lightRef1}\r\n        position={[20, 20, 10]}\r\n        intensity={0.2}\r\n        castShadow\r\n        color=\"#e1ff00\"\r\n        angle={Math.PI / 3}\r\n        penumbra={1}\r\n        shadow-mapSize-width={1024}\r\n        shadow-mapSize-height={1024}\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\nfunction StreamBoxes() {\r\n  const [video] = useState(() => {\r\n    const vid = document\r\n      .getElementById(\"video\")\r\n      .getElementsByTagName(\"video\")[0];\r\n    vid.crossOrigin = \"Anonymous\";\r\n    return vid;\r\n  });\r\n  const { camera } = useThree();\r\n\r\n  const groupRef = useRef();\r\n\r\n  useFrame(({ clock }) => {\r\n    if (groupRef.current) {\r\n      groupRef.current.position.set(\r\n        camera.position.x,\r\n        camera.position.y,\r\n        camera.position.z\r\n      );\r\n      groupRef.current.rotation.y += 0.008;\r\n    }\r\n  });\r\n\r\n  return (\r\n    <group\r\n      ref={groupRef}\r\n      position={[camera.position.x, camera.position.y, camera.position.z]}\r\n    >\r\n      <mesh position={[0, 3, 33]}>\r\n        <boxBufferGeometry\r\n          args={[10, 9, 0.1]}\r\n          rotation={[Math.PI / 2, Math.PI / 2, Math.PI / 2]}\r\n        />\r\n        <meshBasicMaterial>\r\n          <videoTexture attach=\"map\" args={[video]} />\r\n        </meshBasicMaterial>\r\n      </mesh>\r\n\r\n      <mesh position={[20, 7, 0]}>\r\n        <boxBufferGeometry args={[0.1, 5, 6]} rotation={[Math.PI / 2, 0, 0]} />\r\n        <meshBasicMaterial>\r\n          <videoTexture attach=\"map\" args={[video]} />\r\n        </meshBasicMaterial>\r\n      </mesh>\r\n\r\n      <mesh position={[-10, 15, -5]}>\r\n        <boxBufferGeometry args={[7, 0.1, 6]} rotation={[Math.PI / 2, 0, 0]} />\r\n        <meshBasicMaterial>\r\n          <videoTexture attach=\"map\" args={[video]} />\r\n        </meshBasicMaterial>\r\n      </mesh>\r\n    </group>\r\n  );\r\n}\r\n\r\nfunction Floor() {\r\n  const [meshRef, ReflectorMaterial, passes] = useReflector();\r\n  usePostprocessing(passes);\r\n  return (\r\n    <group position-z={-5}>\r\n      <mesh\r\n        receiveShadow\r\n        ref={meshRef}\r\n        rotation-x={-Math.PI / 2}\r\n        position-y={-3.001}\r\n      >\r\n        <planeBufferGeometry\r\n          receiveShadow\r\n          attach=\"geometry\"\r\n          args={[300, 300]}\r\n        />\r\n\r\n        <ReflectorMaterial\r\n          metalness={0.8}\r\n          roughness={0.3}\r\n          clearcoat={0.5}\r\n          reflectorOpacity={0.3}\r\n          args={[300, 300]}\r\n        />\r\n      </mesh>\r\n    </group>\r\n  );\r\n}\r\n\r\nfunction Sound({ url }) {\r\n  const sound = useRef();\r\n  const { camera } = useThree();\r\n  const [listener] = useState(() => new AudioListener());\r\n  const buffer = useLoader(AudioLoader, url);\r\n  useEffect(() => {\r\n    sound.current.setBuffer(buffer);\r\n    sound.current.setRefDistance(1);\r\n    sound.current.setLoop(true);\r\n    sound.current.play();\r\n    camera.add(listener);\r\n    return () => camera.remove(listener);\r\n  });\r\n  return <positionalAudio ref={sound} args={[listener]} />;\r\n}\r\n\r\nfunction Boxes(props) {\r\n  const groupRef = useRef();\r\n\r\n  useFrame(({ clock }) => {\r\n    const t = clock.getElapsedTime() * 0.5;\r\n\r\n    if (groupRef.current) {\r\n      groupRef.current.children.forEach((element) => {\r\n        element.rotation.x = Math.sin(t) * 0.05;\r\n        element.rotation.y = Math.sin(t) * 0.05;\r\n        element.rotation.z = Math.sin(t) * 0.05;\r\n      });\r\n    }\r\n  });\r\n\r\n  return (\r\n    <group position-z={-5}>\r\n      <group ref={groupRef}>\r\n        <Cubes imageUrls={props.props} />\r\n      </group>\r\n    </group>\r\n  );\r\n}\r\n\r\nexport default class ContentRedistributionCanvas extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      imageUrls: this.props.imageUrls,\r\n      hasStream: this.props.hasStream,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    console.log(\"canvas did mount\", this.props.imageUrls.length);\r\n  }\r\n  componentDidUpdate() {\r\n    console.log(\"canvas did update\", this.props.imageUrls.length);\r\n  }\r\n  shouldComponentUpdate(nextProps, nextState) {\r\n    if (\r\n      this.props.imageUrls.length !== nextProps.imageUrls.length ||\r\n      this.props.loggedIn !== nextProps.loggedIn ||\r\n      this.state.hasStream !== nextState.hasStream\r\n    ) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  callbackFunction = () => {\r\n    this.setState({ hasStream: true });\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        {this.props.loggedIn && (\r\n          <Stream callbackFunction={this.callbackFunction} />\r\n        )}\r\n\r\n        <Canvas\r\n          id=\"canvas\"\r\n          colorManagement\r\n          shadowMap={true}\r\n          camera={{ position: [0, 0, 10], far: 100, near: 0.1, fov: 60 }}\r\n          resize={{ debounce: { scroll: 0, resize: 0 } }}\r\n          invalidateFrameloop={true}\r\n          gl={{\r\n            powerPreference: \"high-performance\",\r\n            antialias: false,\r\n            alpha: false,\r\n          }}\r\n          style={{\r\n            background: \"black\",\r\n            position: \"fixed\",\r\n            top: \"0\",\r\n            bottom: \"0\",\r\n            right: \"0\",\r\n            left: \"0\",\r\n            zIndex: \"0\",\r\n          }}\r\n        >\r\n          <Floor />\r\n\r\n          <Boxes props={this.state.imageUrls} />\r\n\r\n          <fogExp2 attach=\"fog\" args={[0xbffffd, 0.049]} />\r\n\r\n          <ambientLight intensity={0.3} />\r\n\r\n          <Suspense fallback={null}>\r\n            <Sound url=\"https://res.cloudinary.com/www-houseofkilling-com/video/upload/v1620900008/sounds/AliveForever_clhtnw.mp3\" />\r\n\r\n            <RSphere position={[10, 0, 10]} args={[7, 32, 32]} />\r\n\r\n            <RSphere position={[-70, 5, 20]} args={[3, 32, 32]} />\r\n\r\n            <RSphere position={[50, 10, -40]} args={[10, 32, 32]} />\r\n\r\n            <RSphere position={[0, 0, 0]} args={[50, 32, 32]} />\r\n          </Suspense>\r\n\r\n          <Environment files=\"vr_landscape.hdr\" background={false} />\r\n\r\n          <Fireflies count={500} position={[0, 0, 0]} />\r\n\r\n          <Fireflies count={500} position={[-50, 0, 0]} />\r\n\r\n          <Fireflies count={500} position={[-50, 0, 20]} />\r\n\r\n          <Physics gravity={[0, 0, 0]}>\r\n            <Control />\r\n          </Physics>\r\n\r\n          <Lights />\r\n\r\n          {this.state.hasStream && <StreamBoxes />}\r\n\r\n          <Sky\r\n            distance={450000} // Camera distance (default=450000)\r\n            sunPosition={[0, 10, 0]} // Sun position normal (defaults to inclination and azimuth if not set)\r\n            inclination={1} // Sun elevation angle from 0 to 1 (default=0)\r\n            azimuth={0.25}\r\n          />\r\n        </Canvas>\r\n        <Loader dataInterpolation={(p) => `waking up ${p.toFixed(5)}%`} />\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { useCallback, useMemo, useState, useRef } from \"react\";\nimport {\n  LinearFilter,\n  MathUtils,\n  Matrix4,\n  PerspectiveCamera,\n  Plane,\n  RGBFormat,\n  Vector3,\n  Vector4,\n  WebGLRenderTarget,\n  RGBADepthPacking,\n} from \"three\";\nimport {\n  SavePass,\n  RenderPass,\n  LambdaPass,\n  DepthPass,\n  EffectPass,\n  DepthOfFieldEffect,\n} from \"postprocessing\";\nimport { useThree } from \"@react-three/fiber\";\nimport { ReflectorMaterial } from \"./reflector-material\";\n\nexport function useReflector(\n  textureWidth = 512,\n  textureHeight = 512,\n  clipBias = 0\n) {\n  const meshRef = useRef();\n  const [reflectorPlane] = useState(() => new Plane());\n  const [normal] = useState(() => new Vector3());\n  const [reflectorWorldPosition] = useState(() => new Vector3());\n  const [cameraWorldPosition] = useState(() => new Vector3());\n  const [rotationMatrix] = useState(() => new Matrix4());\n  const [lookAtPosition] = useState(() => new Vector3(0, 0, -1));\n  const [clipPlane] = useState(() => new Vector4());\n  const [view] = useState(() => new Vector3());\n  const [target] = useState(() => new Vector3());\n  const [q] = useState(() => new Vector4());\n  const [textureMatrix] = useState(() => new Matrix4());\n  const [virtualCamera] = useState(() => new PerspectiveCamera());\n  const { gl: renderer, scene, camera } = useThree();\n\n  const beforeRender = useCallback(\n    function beforeRender() {\n      if (!meshRef.current) return;\n      meshRef.current.visible = false;\n      reflectorWorldPosition.setFromMatrixPosition(meshRef.current.matrixWorld);\n      cameraWorldPosition.setFromMatrixPosition(camera.matrixWorld);\n\n      rotationMatrix.extractRotation(meshRef.current.matrixWorld);\n\n      normal.set(0, 0, 1);\n      normal.applyMatrix4(rotationMatrix);\n\n      view.subVectors(reflectorWorldPosition, cameraWorldPosition);\n\n      // Avoid rendering when reflector is facing away\n      if (view.dot(normal) > 0) return;\n\n      view.reflect(normal).negate();\n      view.add(reflectorWorldPosition);\n\n      rotationMatrix.extractRotation(camera.matrixWorld);\n\n      lookAtPosition.set(0, 0, -1);\n      lookAtPosition.applyMatrix4(rotationMatrix);\n      lookAtPosition.add(cameraWorldPosition);\n\n      target.subVectors(reflectorWorldPosition, lookAtPosition);\n      target.reflect(normal).negate();\n      target.add(reflectorWorldPosition);\n\n      virtualCamera.position.copy(view);\n      virtualCamera.up.set(0, 1, 0);\n      virtualCamera.up.applyMatrix4(rotationMatrix);\n      virtualCamera.up.reflect(normal);\n      virtualCamera.lookAt(target);\n\n      virtualCamera.far = camera.far; // Used in WebGLBackground\n\n      virtualCamera.updateMatrixWorld();\n      virtualCamera.projectionMatrix.copy(camera.projectionMatrix);\n\n      // Update the texture matrix\n      textureMatrix.set(\n        0.5,\n        0.0,\n        0.0,\n        0.5,\n        0.0,\n        0.5,\n        0.0,\n        0.5,\n        0.0,\n        0.0,\n        0.5,\n        0.5,\n        0.0,\n        0.0,\n        0.0,\n        1.0\n      );\n      textureMatrix.multiply(virtualCamera.projectionMatrix);\n      textureMatrix.multiply(virtualCamera.matrixWorldInverse);\n      textureMatrix.multiply(meshRef.current.matrixWorld);\n\n      // Now update projection matrix with new clip plane, implementing code from: http://www.terathon.com/code/oblique.html\n      // Paper explaining this technique: http://www.terathon.com/lengyel/Lengyel-Oblique.pdf\n      reflectorPlane.setFromNormalAndCoplanarPoint(\n        normal,\n        reflectorWorldPosition\n      );\n      reflectorPlane.applyMatrix4(virtualCamera.matrixWorldInverse);\n\n      clipPlane.set(\n        reflectorPlane.normal.x,\n        reflectorPlane.normal.y,\n        reflectorPlane.normal.z,\n        reflectorPlane.constant\n      );\n\n      const projectionMatrix = virtualCamera.projectionMatrix;\n\n      q.x =\n        (Math.sign(clipPlane.x) + projectionMatrix.elements[8]) /\n        projectionMatrix.elements[0];\n      q.y =\n        (Math.sign(clipPlane.y) + projectionMatrix.elements[9]) /\n        projectionMatrix.elements[5];\n      q.z = -1.0;\n      q.w =\n        (1.0 + projectionMatrix.elements[10]) / projectionMatrix.elements[14];\n\n      // Calculate the scaled plane vector\n      clipPlane.multiplyScalar(2.0 / clipPlane.dot(q));\n\n      // Replacing the third row of the projection matrix\n      projectionMatrix.elements[2] = clipPlane.x;\n      projectionMatrix.elements[6] = clipPlane.y;\n      projectionMatrix.elements[10] = clipPlane.z + 1.0 - clipBias;\n      projectionMatrix.elements[14] = clipPlane.w;\n    },\n    [\n      clipBias,\n      meshRef,\n      camera,\n      reflectorPlane,\n      normal,\n      reflectorWorldPosition,\n      cameraWorldPosition,\n      rotationMatrix,\n      lookAtPosition,\n      clipPlane,\n      view,\n      target,\n      q,\n      textureMatrix,\n      virtualCamera,\n    ]\n  );\n\n  function afterRender() {\n    if (!meshRef.current) return;\n    meshRef.current.visible = true;\n  }\n\n  const {\n    renderPass,\n    savePass,\n    depthPass,\n    blurPass,\n    lambdaPassBefore,\n    lambdaPassAfter,\n  } = useMemo(() => {\n    const parameters = {\n      minFilter: LinearFilter,\n      magFilter: LinearFilter,\n      format: RGBFormat,\n    };\n    const renderTarget = new WebGLRenderTarget(\n      textureWidth,\n      textureHeight,\n      parameters\n    );\n    renderTarget.texture.encoding = renderer.outputEncoding;\n\n    if (\n      !MathUtils.isPowerOfTwo(textureWidth) ||\n      !MathUtils.isPowerOfTwo(textureHeight)\n    ) {\n      renderTarget.texture.generateMipmaps = false;\n    }\n\n    const renderPass = new RenderPass(scene, virtualCamera);\n    const depthPass = new DepthPass(scene, virtualCamera);\n    const dof = new DepthOfFieldEffect(virtualCamera, {\n      focusDistance: 0.3,\n      focalLength: 0.6,\n      bokehScale: 3.0,\n    });\n    const blurPass = new EffectPass(virtualCamera, dof);\n    blurPass.setDepthTexture(depthPass.texture, RGBADepthPacking);\n\n    const savePass = new SavePass(renderTarget);\n    const lambdaPassBefore = new LambdaPass(beforeRender);\n    const lambdaPassAfter = new LambdaPass(afterRender);\n    return {\n      renderPass,\n      savePass,\n      lambdaPassBefore,\n      lambdaPassAfter,\n      blurPass,\n      depthPass,\n    };\n  }, [\n    textureWidth,\n    textureHeight,\n    beforeRender,\n    virtualCamera,\n    scene,\n    renderer.outputEncoding,\n  ]);\n\n  const Material = useMemo(\n    () => ReflectorMaterial({ savePass, textureMatrix }),\n    [savePass, textureMatrix]\n  );\n\n  return [\n    meshRef,\n    Material,\n    [\n      lambdaPassBefore,\n      renderPass,\n      depthPass,\n      blurPass,\n      savePass,\n      lambdaPassAfter,\n    ],\n  ];\n}\n","import React, { Suspense, useCallback, useState, useRef } from \"react\";\r\nimport ContentRedistributionCanvas from \"./canvas\";\r\nimport Dropzone from \"react-dropzone\";\r\n\r\n// import SongPlayer from \"./MusicPlayer\";\r\n// <SongPlayer audioUrl=\"https://res.cloudinary.com/www-houseofkilling-com/video/upload/v1620900008/sounds/AliveForever_clhtnw.mp3\" />\r\n\r\nfunction MyDropzone(props) {\r\n  const [message, setMessage] = useState(\r\n    \"Drag 'n' drop some files here, or click to select files\"\r\n  );\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  const inputField = useRef();\r\n\r\n  const handleDrop = useCallback(\r\n    (acceptedFiles) => {\r\n      if (acceptedFiles[0]) {\r\n        const reader = new FileReader();\r\n\r\n        reader.readAsDataURL(acceptedFiles[0]);\r\n        reader.onloadstart = () => {\r\n          console.log(\"loads file\");\r\n          setMessage(\"loading file:\");\r\n          setIsLoading(true);\r\n        };\r\n        reader.onloadend = () => {\r\n          console.log(\"has file\");\r\n          props.uploadImage(reader.result);\r\n\r\n          if (reader.error) {\r\n            setMessage(\"that didnt go according to plan\");\r\n          } else {\r\n            setTimeout(() => {\r\n              setMessage(\"thank you for your expression. i love it\");\r\n              setTimeout(() => {\r\n                setMessage(\r\n                  \"Drag 'n' drop some files here, or click to select files\"\r\n                );\r\n                setIsLoading(false);\r\n              }, 2000);\r\n              setIsLoading(false);\r\n            }, 1000);\r\n          }\r\n        };\r\n      }\r\n    },\r\n    [props]\r\n  );\r\n\r\n  return (\r\n    <Dropzone\r\n      onDrop={handleDrop}\r\n      accept=\"image/*\"\r\n      minSize={1024}\r\n      maxSize={3072000}\r\n      className=\"container\"\r\n    >\r\n      {({ getRootProps, getInputProps }) => (\r\n        <div\r\n          {...getRootProps({ className: \"dropzone\" })}\r\n          style={{ width: \"100%\", height: \"100%\" }}\r\n          ref={inputField}\r\n        >\r\n          <input {...getInputProps()} />\r\n          {!isLoading ? <p>{message}</p> : <p>is loading</p>}\r\n        </div>\r\n      )}\r\n    </Dropzone>\r\n  );\r\n}\r\n\r\nexport default class ContentRedistribution extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      imageUrls: [],\r\n      hasNewImage: true,\r\n      previewSource: \"\",\r\n      hasBroadcast: false,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.loadImages();\r\n    this.setState({ hasNewImage: false });\r\n\r\n    this.props.socket.on(\"message\", (data) => {\r\n      if (data.newImage) {\r\n        if (!this.state.imageUrls.includes(data.newImage)) {\r\n          this.setState({\r\n            imageUrls: [...this.state.imageUrls, data.newImage],\r\n          });\r\n        }\r\n      }\r\n      if (data.broadcast) {\r\n        console.log(\"has broadcast\", data);\r\n        this.setState({\r\n          hasBroadcast: true,\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  loadImages = async () => {\r\n    try {\r\n      const res = await fetch(\"/api/getallimages\");\r\n      const data = await res.json();\r\n      this.setState({ imageUrls: data.images });\r\n    } catch (error) {\r\n      console.error(\"this is the output error\", error);\r\n    }\r\n  };\r\n\r\n  handleFileInputChange = (e) => {\r\n    const file = e.target.files[0];\r\n    console.log(file);\r\n    this.previewFile(file);\r\n  };\r\n\r\n  uploadImage = async (base64EncodedImage) => {\r\n    try {\r\n      const res = await fetch(\"/api/upload\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify({ data: base64EncodedImage }),\r\n        headers: { \"Content-type\": \"application/json\" },\r\n      });\r\n      const data = await res.json();\r\n\r\n      console.log(\"succesful upload\", data);\r\n\r\n      this.setState({ hasNewImage: true, previewSource: \"\" });\r\n\r\n      this.props.socket.emit(\"uploadImage\", { data }, (error) => {});\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        {this.state.imageUrls.length > 1 ? (\r\n          <Suspense fallback={null}>\r\n            <ContentRedistributionCanvas\r\n              imageUrls={this.state.imageUrls}\r\n              loggedIn={this.props.loggedIn}\r\n              hasBroadcast={this.state.hasBroadcast}\r\n            />\r\n          </Suspense>\r\n        ) : null}\r\n\r\n        {this.props.loggedIn && (\r\n          <>\r\n            <div\r\n              style={{\r\n                position: \"absolute\",\r\n                bottom: \"0\",\r\n                left: \"0\",\r\n                display: \"flex\",\r\n                flexFlow: \"column-reverse\",\r\n                zIndex: \"99999999999\",\r\n                height: \"150px\",\r\n                width: \"250px\",\r\n              }}\r\n              className=\"container\"\r\n            >\r\n              <p\r\n                style={{\r\n                  position: \"absolute\",\r\n                  bottom: \"105%\",\r\n                  fontSize: \"15px\",\r\n                }}\r\n              >\r\n                Feed me expressions plz\r\n              </p>\r\n              <MyDropzone uploadImage={this.uploadImage} />\r\n            </div>\r\n          </>\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import React, { useRef } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nexport default function Broadcast() {\r\n  const button = useRef();\r\n  const video = useRef();\r\n\r\n  async function init() {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: true,\r\n        audio: true,\r\n      });\r\n      video.current.srcObject = stream;\r\n      const peer = createPeer();\r\n      stream.getTracks().forEach((track) => peer.addTrack(track, stream));\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  }\r\n\r\n  function createPeer() {\r\n    const peer = new RTCPeerConnection({\r\n      iceServers: [\r\n        {\r\n          urls: \"stun:stun.l.google.com:19302\",\r\n        },\r\n        {\r\n          url: \"turn:192.158.29.39:3478?transport=udp\",\r\n          credential: \"JZEOEt2V3Qb0y27GRntt2u2PAYA=\",\r\n          username: \"28224511:1379330808\",\r\n        },\r\n      ],\r\n    });\r\n    peer.onnegotiationneeded = () => handleNegotiationNeededEvent(peer);\r\n\r\n    return peer;\r\n  }\r\n\r\n  function endStream() {\r\n    axios.post(\"/api/endbroadcast\");\r\n  }\r\n\r\n  async function handleNegotiationNeededEvent(peer) {\r\n    const offer = await peer.createOffer();\r\n    await peer.setLocalDescription(offer);\r\n    const payload = {\r\n      sdp: peer.localDescription,\r\n    };\r\n\r\n    console.log(\"BROADCASTER SENDS\", payload);\r\n\r\n    const { data } = await axios.post(\"/api/broadcast\", payload);\r\n\r\n    const desc = new RTCSessionDescription(data.sdp);\r\n    peer\r\n      .setRemoteDescription(desc)\r\n      .catch((e) => console.log(\"there is an error\", e));\r\n  }\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        position: \"absolute\",\r\n        top: \"0\",\r\n        bottom: \"0\",\r\n        right: \"0\",\r\n        left: \"0\",\r\n        zIndex: \"10\",\r\n      }}\r\n    >\r\n      <button ref={button} id=\"my-button\" onClick={init}>\r\n        Start Stream\r\n      </button>\r\n      <button ref={button} id=\"my-button\" onClick={endStream}>\r\n        End Stream\r\n      </button>\r\n\r\n      <video ref={video} autoPlay controls id=\"video\"></video>\r\n    </div>\r\n  );\r\n}\r\n","import React, { Suspense, useRef, useState } from \"react\";\n\nimport Chat from \"./components/Chat/Chat\";\nimport ContentRedistribution from \"./components/content_redistribution\";\n\nimport \"./App.css\";\n\nimport { BrowserRouter as Router, Route } from \"react-router-dom\";\n\nimport Broadcast from \"./components/Broadcast/Broadcast.js\";\n\nimport io from \"socket.io-client\";\n\nconst ENDPOINT = \"https://stayvirtual-chat-backend.herokuapp.com/\";\n\nconst socket = io(ENDPOINT);\n\nconst App = () => {\n  const [name, setName] = useState();\n  const [loggedIn, setLoggedIn] = useState();\n  const [myID, setMyID] = useState();\n\n  const nameRef = useRef();\n\n  function runConnection(nameRef) {\n    const name = nameRef;\n    setLoggedIn(true);\n\n    socket.emit(\"join\", { name }, (error) => {\n      if (error) {\n        alert(error);\n        setLoggedIn(false);\n      }\n    });\n    socket.on(\"me\", (id) => {\n      setMyID(id);\n    });\n  }\n\n  return (\n    <Router>\n      <Route path=\"/\" exact>\n        {!loggedIn && (\n          <>\n            <div className=\"outer-container\" style={{ zIndex: \"1\" }}>\n              <div className=\"circletype-container\">\n                <p id=\"circletype\">\n                  www.stayvirtual.online** softly introduces H r w a i l Archive\n                  of Human Expression* ·{\" \"}\n                </p>\n              </div>\n              <div className=\"container\">\n                <input\n                  placeholder=\"Name\"\n                  className=\"input\"\n                  type=\"text\"\n                  ref={nameRef}\n                />\n              </div>\n\n              <button\n                onClick={(e) => {\n                  setName(nameRef.current.value);\n                  runConnection(nameRef.current.value);\n                }}\n                className={\"sendButton\"}\n                type=\"submit\"\n              >\n                Sign In\n              </button>\n            </div>\n            <p>\n              * a generative encyclopedia of images as expressions. <br></br>\n              ** an open source landscape <br></br> + live chat\n            </p>\n          </>\n        )}\n\n        <Suspense fallback={null}>\n          <ContentRedistribution\n            socket={socket}\n            loggedIn={loggedIn}\n            name={name}\n            myID={myID}\n          />\n          <Chat socket={socket} loggedIn={loggedIn} name={name} myID={myID} />\n        </Suspense>\n      </Route>\n\n      <Route path=\"/broadcast\" exact>\n        <Broadcast socket={socket} />\n      </Route>\n    </Router>\n  );\n};\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));"],"sourceRoot":""}